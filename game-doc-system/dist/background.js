(()=>{"use strict";var e,t,o;!function(e){e.GameVision="game_vision",e.CoreGameConcept="core_game_concept",e.TargetAudience="target_audience",e.CorePillarsValues="core_pillars_values",e.WhyPlayIt="why_play_it",e.WhatShouldTheyFeel="what_should_they_feel",e.UniqueSellingPoints="unique_selling_points",e.GameLoop="game_loop",e.PlayerJourney="player_journey",e.StoryOverview="story_overview",e.Presentation="presentation",e.KeyQuestions="key_questions",e.CoreDesignDetails="core_design_details",e.StrategicDirection="strategic_direction"}(e||(e={})),function(e){e.NotStarted="not_started",e.InProgress="in_progress",e.Completed="completed"}(t||(t={})),function(e){e.GetProjects="get_projects",e.CreateProject="create_project",e.UpdateProject="update_project",e.DeleteProject="delete_project",e.GetProject="get_project",e.CreateDocument="create_document",e.UpdateDocument="update_document",e.GetDocument="get_document",e.DeleteDocument="delete_document",e.StartDocumentCreation="start_document_creation"}(o||(o={}));const r=new class{async initialize(){await this.getProjects()||(await chrome.storage.local.set({projects:{}}),console.log("Storage initialized with empty projects"))}async getProjects(){return(await chrome.storage.local.get("projects")).projects||null}async getProject(e){const t=await this.getProjects();return t&&t[e]?t[e]:null}async createProject(e){const t=await this.getProjects()||{},o="project_"+Date.now(),r=Date.now(),a={id:o,name:e,createdAt:r,updatedAt:r,documents:this.createInitialDocuments(o)};return t[o]=a,await chrome.storage.local.set({projects:t}),a}createInitialDocuments(o){const r={},a=Date.now();return Object.values(e).forEach((e=>{const n=`${o}_${e}`;r[n]={id:n,projectId:o,type:e,title:this.getDefaultTitle(e),content:"",status:t.NotStarted,createdAt:a,updatedAt:a,versions:[]}})),r}getDefaultTitle(t){return{[e.GameVision]:"Game Vision",[e.CoreGameConcept]:"Core Game Concept",[e.TargetAudience]:"Target Audience",[e.CorePillarsValues]:"Core Pillars and Values",[e.WhyPlayIt]:"Why Would They Play It?",[e.WhatShouldTheyFeel]:"What Should They Feel?",[e.UniqueSellingPoints]:"Unique Selling Points",[e.GameLoop]:"Game Loop",[e.PlayerJourney]:"Player Journey",[e.StoryOverview]:"Story Overview",[e.Presentation]:"Presentation",[e.KeyQuestions]:"Key Questions",[e.CoreDesignDetails]:"Core Design Details",[e.StrategicDirection]:"Strategic Direction"}[t]||"Untitled Document"}async updateDocument(e){const t=await this.getProjects();if(!t)throw new Error("No projects found");const o=t[e.projectId];if(!o)throw new Error("Project not found");const r=o.documents[e.id];if(r&&r.content!==e.content&&""!==r.content){const t={versionNumber:r.versions.length+1,content:r.content,createdAt:Date.now(),notes:"Automatic version created"};e.versions=[...r.versions,t]}return e.updatedAt=Date.now(),o.documents[e.id]=e,o.updatedAt=Date.now(),await chrome.storage.local.set({projects:t}),e}async deleteProject(e){const t=await this.getProjects();t&&(delete t[e],await chrome.storage.local.set({projects:t}))}};chrome.runtime.onInstalled.addListener((async()=>{console.log("Game Development Document System installed/updated"),await r.initialize()})),chrome.runtime.onMessage.addListener(((e,t,a)=>(async function(e){console.log("Background received message:",e);const{type:t,payload:a}=e;try{switch(t){case o.GetProjects:return{success:!0,data:await r.getProjects()};case o.CreateProject:return{success:!0,data:await r.createProject(a.name)};case o.GetProject:return{success:!0,data:await r.getProject(a.projectId)};case o.UpdateDocument:return{success:!0,data:await r.updateDocument(a.document)};case o.DeleteProject:return await r.deleteProject(a.projectId),{success:!0};default:return{success:!1,error:`Unknown message type: ${t}`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}(e).then(a).catch((e=>{console.error("Error handling message:",e),a({success:!1,error:e.message})})),!0)))})();
//# sourceMappingURL=background.js.map