// src/services/messageManager.js
import { UI } from '../config/constants';
import { gameStore } from '../state/store';
import { TERRAIN_TYPES, SPECIAL_LOCATIONS } from '../config/terrain';

export const MessageManager = {
    showPlayerMessage(message, type = UI.MESSAGE_TYPES.STATUS) {
        // console.log('MessageManager.showPlayerMessage called:', { message, type });
        if (!gameStore.messages) {
            console.error('gameStore.messages is undefined');
            return;
        }
        // console.log('Current gameStore state:', gameStore);
        gameStore.messages.addMessage(message, type);
        // console.log('Message added to store:', gameStore.messages);
    },

    updateCurrentLocationInfo() {
        // console.log('updateCurrentLocationInfo called');
        const { q, r } = gameStore.playerPosition;
        const playerHex = document.querySelector(`polygon[data-q="${q}"][data-r="${r}"]`);
        if (!playerHex) {
            // console.log('No player hex found at position:', { q, r });
            return;
        }

        const terrain = playerHex.getAttribute('data-terrain');
        // console.log('Found terrain:', terrain);
        const terrainInfo = terrain === 'BASE_CAMP' ? SPECIAL_LOCATIONS.BASE_CAMP :
                         terrain === 'SOUTH_POLE' ? SPECIAL_LOCATIONS.SOUTH_POLE :
                         TERRAIN_TYPES[terrain];
        
        if (terrainInfo) {
            // console.log('Showing terrain message:', terrainInfo.quote);
            this.showPlayerMessage(terrainInfo.quote, UI.MESSAGE_TYPES.TERRAIN);
        }
    },

    showInitialMessage() {
        // console.log('Showing initial message');
        this.showPlayerMessage(
            "Before you lies the vast Antarctic expanse, untamed and unforgiving. " +
            "The freezing wind howls a challenge promising either immortal glory " +
            "or eternal rest beneath the ice.",
            UI.MESSAGE_TYPES.STATUS
        );
    },

    showDeathMessage() {
        // console.log('Showing death message');
        this.showPlayerMessage(
            "The bitter Antarctic winds howl a mournful dirge as your frozen form becomes " +
            "one with the endless white expanse. Your journey ends here, but the South Pole " +
            "remains, waiting for the next brave soul to challenge its deadly embrace.",
            UI.MESSAGE_TYPES.STATUS
        );
    },

    showVictoryMessage() {
        // console.log('Showing victory message');
        this.showPlayerMessage(
            "Against all odds, you've done it! You've reached the South Pole " +
            "and returned to tell the tale. Your name will be forever etched " +
            "in the annals of polar exploration.",
            UI.MESSAGE_TYPES.STATUS
        );
    },

    showWeatherMessage(type) {
        // console.log('Showing weather message for type:', type);
        const messages = {
            BLIZZARD: "A blizzard sweeps in, obscuring your view...",
            WHITEOUT: "The air grows thick with snow...",
            BLIZZARD_END: "The blizzard subsides, your surroundings becoming familiar once again...",
            WHITEOUT_END: "The white out phenomenon clears, but nothing looks familiar anymore..."
        };

        if (messages[type]) {
            this.showPlayerMessage(messages[type], UI.MESSAGE_TYPES.WEATHER);
        }
    }
};

export default MessageManager;