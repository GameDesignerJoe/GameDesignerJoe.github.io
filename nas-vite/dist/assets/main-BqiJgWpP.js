(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();const C={BASE_DURATION:500,STAMINA_FACTOR:50,MIN_DURATION:500,MAX_DURATION:2e3,STAMINA_COST:2},l={SIZE:12,HEX_SIZE:30,get HEX_HEIGHT(){return this.HEX_SIZE*2},get HEX_WIDTH(){return Math.sqrt(3)*this.HEX_SIZE}},c={MAX_VALUE:100,MIN_VALUE:0,MOVE_STAMINA_COST:10,HEAL_RATE:.5,STAMINA_RECOVERY_RATE:.4,HUNGER_DECAY_RATE:.5},P={MESSAGE_TYPES:{STATUS:"status",TERRAIN:"terrain",WEATHER:"weather"},ANIMATION_DURATIONS:{MESSAGE_FADE:300,WEATHER_TRANSITION:1e3}},S={running:!0,won:!1,difficultyLevel:1,timeElapsed:0,lastUpdate:Date.now(),world:{southPole:null,southPoleSpotted:!1,southPoleVisited:!1,baseCamp:null,selectedHex:null,visibleHexes:new Set,visitedHexes:new Set,terrain:{},shownThresholds:new Set},resetGame(){this.won=!1,this.running=!0,this.timeElapsed=0,this.world.southPoleSpotted=!1,this.world.southPoleVisited=!1,this.world.visitedHexes.clear(),this.world.shownThresholds.clear(),this.lastUpdate=Date.now()},pauseGame(){this.running=!1},resumeGame(){this.running=!0,this.lastUpdate=Date.now()},winGame(){this.won=!0,this.running=!1},hasShownThreshold(t){return this.world.shownThresholds.has(t)},markThresholdShown(t){this.world.shownThresholds.add(t)},updateTimeElapsed(){if(!this.running)return;const t=Date.now();this.timeElapsed+=t-this.lastUpdate,this.lastUpdate=t}};Object.getOwnPropertyNames(S).filter(t=>typeof S[t]=="function").forEach(t=>{S[t]=S[t].bind(S)});const O={WHITEOUT:{name:"Whiteout",healthDecayMultiplier:1.05,transitions:{fadeIn:15e3,hold:1e4,fadeOut:8e3},scheduling:{minInterval:12e4,maxInterval:24e4},visibility:{range:1,fogDensity:1}},BLIZZARD:{name:"Blizzard",healthDecayMultiplier:1.02,transitions:{fadeIn:5e3,hold:15e3,fadeOut:1e4},scheduling:{minInterval:45e3,maxInterval:9e4},visibility:{range:2,fogDensity:.8}}},U=()=>({current:{type:null,startTime:null,phase:null,intensity:0,nextScheduled:null},visibility:{temporaryFog:new Set,affectedHexes:new Set,lastUpdate:null},effects:{whiteoutActive:!1,blizzardActive:!1,whiteoutPhase:!1,weatherTimeout:null},methods:{startWeatherEvent(t){this.current.type=t,this.current.startTime=Date.now(),this.current.phase="fadeIn",this.current.intensity=0,t==="WHITEOUT"?(this.effects.whiteoutActive=!0,this.effects.whiteoutPhase=!0):t==="BLIZZARD"&&(this.effects.blizzardActive=!0)},updateWeatherPhase(t){switch(this.current.phase=t,t){case"fadeIn":this.current.intensity=0;break;case"hold":this.current.intensity=1;break;case"fadeOut":this.current.intensity=1;break;default:this.current.intensity=0}},scheduleNextWeather(t){this.current.nextScheduled=t},clearWeather(){this.current.type=null,this.current.startTime=null,this.current.phase=null,this.current.intensity=0,this.effects.whiteoutActive=!1,this.effects.blizzardActive=!1,this.effects.whiteoutPhase=!1,this.effects.weatherTimeout&&(clearTimeout(this.effects.weatherTimeout),this.effects.weatherTimeout=null),this.visibility.temporaryFog.clear(),this.visibility.affectedHexes.clear()},updateVisibility(t,e){e?this.visibility.temporaryFog.add(t):this.visibility.temporaryFog.delete(t),this.visibility.lastUpdate=Date.now()},reset(){this.current={type:null,startTime:null,phase:null,intensity:0,nextScheduled:null},this.visibility.temporaryFog.clear(),this.visibility.affectedHexes.clear(),this.visibility.lastUpdate=null,this.effects.whiteoutActive=!1,this.effects.blizzardActive=!1,this.effects.whiteoutPhase=!1,this.effects.weatherTimeout=null}}}),H=U();Object.keys(H.methods).forEach(t=>{H.methods[t]=H.methods[t].bind(H)});const d=H,M={position:{q:0,r:0},lastMoveTime:Date.now(),lastStatUpdate:Date.now(),stats:{health:c.MAX_VALUE,stamina:c.MAX_VALUE,hunger:c.MAX_VALUE},inventory:{food:100,fuel:100,tools:100},updatePosition(t){this.position={...t},this.lastMoveTime=Date.now()},updateStats(t){Object.assign(this.stats,t),this.lastStatUpdate=Date.now()},resetStats(){this.stats={health:c.MAX_VALUE,stamina:c.MAX_VALUE,hunger:c.MAX_VALUE},this.lastStatUpdate=Date.now()},consumeStamina(t){this.stats.stamina=Math.max(0,this.stats.stamina-t)},consumeFood(t){this.stats.hunger=Math.max(0,this.stats.hunger-t)},heal(t){this.stats.health=Math.min(c.MAX_VALUE,this.stats.health+t)},isDead(){return this.stats.health<=0}};Object.getOwnPropertyNames(M).filter(t=>typeof M[t]=="function").forEach(t=>{M[t]=M[t].bind(M)});const q={fogRevealActive:!1,godModeActive:!1,zoomLevel:1,originalVisitedHexes:new Set},a={game:S,weather:d,player:M,debug:q,get playerPosition(){return this.player.position},get visitedHexes(){return this.game.world.visitedHexes},get visibleHexes(){return this.game.world.visibleHexes},get baseCamp(){return this.game.world.baseCamp},get southPole(){return this.game.world.southPole},get gameRunning(){return this.game.running},get gameWon(){return this.game.won},messages:null,DEBUG:{getFullState(){return{game:{...a.game},weather:{...a.weather},player:{...a.player},debug:{...a.debug}}},logState(){console.log("Current Game State:",this.getFullState())}}},E={WHITEOUT:{name:"Whiteout",healthDecayMultiplier:1.05,transitions:{fadeIn:15e3,hold:1e4,fadeOut:8e3},scheduling:{minInterval:12e4,maxInterval:24e4},visibility:{range:1,fogDensity:1}},BLIZZARD:{name:"Blizzard",healthDecayMultiplier:1.02,transitions:{fadeIn:5e3,hold:15e3,fadeOut:1e4},scheduling:{minInterval:45e3,maxInterval:9e4},visibility:{range:2,fogDensity:.8}}},p={OVERLAY_OPACITY:{BLIZZARD:.5,WHITEOUT:1},PLAYER_OPACITY:{NORMAL:1,BLIZZARD:.25,WHITEOUT:0},TERRAIN_OPACITY:{NORMAL:1,WEATHER_AFFECTED:.5,HIDDEN:0}};class G{constructor(e,s,i,r){this.store=e,this.messageSystem=s,this.visibilityManager=i,this.statsService=r,this.initWeatherElements()}initWeatherElements(){const e=document.getElementById("gameGrid");if(!e)return;const s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("id","blizzardOverlay"),s.setAttribute("class","blizzard-overlay"),s.setAttribute("x","-150"),s.setAttribute("y","-150"),s.setAttribute("width","300"),s.setAttribute("height","300"),s.setAttribute("fill","white"),s.setAttribute("opacity","0");const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("id","whiteoutOverlay"),i.setAttribute("class","whiteout-overlay"),i.setAttribute("x","-150"),i.setAttribute("y","-150"),i.setAttribute("width","300"),i.setAttribute("height","300"),i.setAttribute("fill","white"),i.setAttribute("opacity","0"),e.appendChild(s),e.appendChild(i)}triggerBlizzard(){if(!this.store.gameRunning||this.store.weather.effects.blizzardActive||this.store.weather.effects.whiteoutActive)return;this.store.weather.methods.startWeatherEvent("BLIZZARD");const e=document.getElementById("blizzardOverlay"),s=document.getElementById("player");!s||!e||(this.store.weather.visibility.temporaryFog=new Set([...this.store.visitedHexes]),document.querySelectorAll(".fog").forEach(i=>{const r=parseInt(i.getAttribute("data-q")),o=parseInt(i.getAttribute("data-r"));`${r},${o}`===`${this.store.playerPosition.q},${this.store.playerPosition.r}`||(i.classList.add("blizzard-fade"),i.setAttribute("fill-opacity","1"))}),s.classList.add("blizzard-player-fade-in"),this.store.messages.showPlayerMessage("A blizzard sweeps in...","STATUS"),setTimeout(()=>{this.store.weather.methods.updateWeatherPhase("fadeIn"),e.setAttribute("opacity",String(p.OVERLAY_OPACITY.BLIZZARD)),setTimeout(()=>{s.classList.remove("blizzard-player-fade-in"),s.classList.add("blizzard-player-hold"),s.style.opacity=String(p.PLAYER_OPACITY.BLIZZARD),this.store.weather.methods.updateWeatherPhase("hold"),this.visibilityManager.updateVisibility(!0),setTimeout(()=>{this.store.weather.methods.updateWeatherPhase("fadeOut"),e.setAttribute("opacity","0"),s.classList.remove("blizzard-player-hold"),s.classList.add("blizzard-player-fade-out"),document.querySelectorAll(".fog").forEach(i=>{i.classList.remove("blizzard-fade")}),this.store.weather.effects.weatherTimeout=setTimeout(()=>{s.classList.remove("blizzard-player-fade-out"),s.style.opacity=String(p.PLAYER_OPACITY.NORMAL),this.handleBlizzardComplete()},E.BLIZZARD.transitions.fadeOut)},E.BLIZZARD.transitions.hold)},E.BLIZZARD.transitions.fadeIn)},100))}triggerWhiteout(){if(!this.store.gameRunning||this.store.weather.effects.whiteoutActive||this.store.weather.effects.blizzardActive)return;this.store.weather.methods.startWeatherEvent("WHITEOUT");const e=document.getElementById("whiteoutOverlay"),s=document.getElementById("player"),i=document.querySelector(".stats-container");if(!e||!s||!i)return;this.store.messages.showPlayerMessage("The air grows thick with snow...","STATUS"),s.classList.add("whiteout-fade");const r=()=>{document.querySelectorAll("polygon[data-terrain]").forEach(n=>{n.style.opacity=String(p.TERRAIN_OPACITY.HIDDEN)}),document.querySelectorAll(".fog").forEach(n=>{n.classList.remove("movement-fade","blizzard-fade"),n.setAttribute("fill-opacity","1"),n.setAttribute("fill","white"),n.parentElement.appendChild(n)}),e.setAttribute("opacity",String(p.OVERLAY_OPACITY.WHITEOUT)),s.style.opacity=String(p.PLAYER_OPACITY.WHITEOUT),i.classList.add("whiteout-stats"),document.body.style.backgroundColor="#FFFFFF",document.querySelector(".game-container").style.backgroundColor="#FFFFFF",document.querySelector(".grid-container").style.backgroundColor="#FFFFFF",document.getElementById("gameGrid").style.background="white"},o=()=>{document.getElementById("gameGrid").style.background="",s.style.opacity=String(p.PLAYER_OPACITY.NORMAL),e.setAttribute("opacity","0"),i.classList.remove("whiteout-stats"),document.body.style.backgroundColor="#1B4B7C",document.querySelector(".game-container").style.backgroundColor="",document.querySelector(".grid-container").style.backgroundColor="rgba(0, 0, 0, 0.2)",document.querySelectorAll("polygon[data-terrain]").forEach(n=>{n.style.opacity=String(p.TERRAIN_OPACITY.NORMAL)}),document.querySelectorAll(".fog").forEach(n=>{n.classList.add("movement-fade"),n.setAttribute("fill","white"),n.setAttribute("fill-opacity","1")})};setTimeout(()=>{r(),setTimeout(()=>{setTimeout(()=>{o(),setTimeout(()=>{s.classList.remove("whiteout-fade"),this.handleWhiteoutComplete()},E.WHITEOUT.transitions.fadeOut)},E.WHITEOUT.transitions.hold)},E.WHITEOUT.transitions.fadeIn)},100)}handleBlizzardComplete(){this.store.weather.effects.blizzardActive&&(this.store.weather.methods.clearWeather(),this.store.game.world.visitedHexes=new Set([...this.store.weather.visibility.temporaryFog]),this.store.weather.visibility.temporaryFog.clear(),this.visibilityManager.updateVisibility(!1),this.statsService.updateStatsDisplay(),this.store.messages.updateCurrentLocationInfo(),this.store.messages.showPlayerMessage("The blizzard subsides, your surroundings becoming familiar once again...","TERRAIN"),this.scheduleNextWeather())}handleWhiteoutComplete(){this.store.weather.methods.clearWeather(),this.statsService.updateStatsDisplay(),this.store.messages.updateCurrentLocationInfo(),this.scheduleNextWeather(),this.store.messages.showPlayerMessage("The white out phenomenon clears, but nothing looks familiar anymore...","TERRAIN")}scheduleNextWeather(){if(!this.store.gameRunning||this.store.gameWon)return;this.store.weather.effects.weatherTimeout&&clearTimeout(this.store.weather.effects.weatherTimeout);const e=Math.random()<.7,s=e?E.BLIZZARD:E.WHITEOUT,i=s.scheduling.minInterval+Math.random()*(s.scheduling.maxInterval-s.scheduling.minInterval);this.store.weather.methods.scheduleNextWeather(Date.now()+i),this.store.weather.effects.weatherTimeout=setTimeout(()=>e?this.triggerBlizzard():this.triggerWhiteout(),i)}resetWeatherState(){this.store.weather.methods.clearWeather();const e=document.getElementById("blizzardOverlay"),s=document.getElementById("whiteoutOverlay"),i=document.getElementById("player"),r=document.querySelector(".stats-container");e&&e.setAttribute("opacity","0"),s&&s.setAttribute("opacity","0"),i&&(i.classList.remove("blizzard-player-fade-in","blizzard-player-hold","blizzard-player-fade-out","whiteout-fade"),i.style.opacity=String(p.PLAYER_OPACITY.NORMAL)),r&&r.classList.remove("whiteout-stats"),document.querySelectorAll("polygon[data-terrain]").forEach(h=>{h.style.opacity=String(p.TERRAIN_OPACITY.NORMAL)}),document.querySelectorAll(".fog").forEach(h=>{h.classList.remove("blizzard-fade","movement-fade"),h.classList.add("movement-fade"),h.setAttribute("fill-opacity","1")}),document.body.style.backgroundColor="#1B4B7C";const o=document.querySelector(".game-container"),n=document.querySelector(".grid-container");o&&(o.style.backgroundColor=""),n&&(n.style.backgroundColor="rgba(0, 0, 0, 0.2)")}}const T={NORMAL_SNOW:{name:"Normal Snow",color:"#E0F7FA",staminaCost:5,passable:!0,description:"A relatively firm snowpack that allows for steady progress.",quote:"The surface here is even, the snow packed firm beneath our feet."},DEEP_SNOW:{name:"Deep Snow",color:"#A3CFE0",staminaCost:10,passable:!0,description:"Loose, deep snow that drains stamina more quickly.",quote:"Each step sinks deep into the powder, making progress exhausting."},CLIFF:{name:"Cliff",color:"#6c7d8c",staminaCost:20,passable:!0,oneWay:!0,description:"A steep descent that can only be traversed downward.",quote:"A sheer drop looms before us. Once we descend, there's no climbing back up."},CREVASSE:{name:"Crevasse",color:"#1e3950",passable:!1,description:"A deep crack in the ice. Impossible to cross without proper equipment.",quote:"A yawning chasm splits the ice, far too wide to risk crossing."},ICE_FIELD:{name:"Ice Field",color:"#CCE5FF",staminaCost:0,healthRisk:.03,passable:!0,description:"Smooth ice that's easy to traverse but dangerously cold.",quote:"The ice stretches out like polished glass, beautiful but punishing when you slip."}},g={BASE_CAMP:{name:"Base Camp",color:"gold",staminaCost:0,passable:!0,quote:"The relative safety of base camp offers a moment of respite."},SOUTH_POLE:{name:"South Pole",color:"#000080",staminaCost:5,passable:!0,quote:"Could this be it? The goal of your expedition stands before you."}},_=()=>{const t=Object.keys(T),e={NORMAL_SNOW:.4,DEEP_SNOW:.3,CLIFF:.1,CREVASSE:.1,ICE_FIELD:.1},s=Math.random();let i=0;for(const r of t)if(i+=e[r],s<i)return r;return"NORMAL_SNOW"},m={DISPLAY_TIME:5e3,FADE_TIME:300,TYPES:{STATUS:"status",TERRAIN:"terrain-info",NARRATIVE:"narrative",WEATHER:"weather",DEBUG:"debug"}};class F{constructor(e){this.store=e,this.initializeElements(),this.currentPlayerMessage=null,this.playerMessageTimeout=null}initializeElements(){if(this.gameMessageContainer=document.getElementById("message-container"),this.gameMessageElement=document.getElementById("game-message"),!this.gameMessageContainer||!this.gameMessageElement){console.error("Message elements not found");return}if(this.playerMessageContainer=document.getElementById("player-message-container"),this.playerMessageText=document.getElementById("player-message-text"),!this.playerMessageContainer||!this.playerMessageText){console.warn("Player message elements not found, creating them...");const e=document.createElement("div");e.id="player-message-container",e.className="player-message";const s=document.createElement("p");s.id="player-message-text",e.appendChild(s),document.querySelector(".grid-container").appendChild(e),this.playerMessageContainer=e,this.playerMessageText=s}}showGameMessage(e,s=m.TYPES.STATUS){this.gameMessageElement&&(this.gameMessageElement.className=s,this.gameMessageElement.innerHTML=e,this.gameMessageContainer.classList.add("has-message"),this.store.messages.currentMessage=e)}showPlayerMessage(e,s=m.TYPES.STATUS){!this.playerMessageContainer||!this.playerMessageText||(this.playerMessageTimeout&&clearTimeout(this.playerMessageTimeout),this.playerMessageText.textContent=e,this.playerMessageContainer.className=`player-message ${s}-message visible`,s!==m.TYPES.NARRATIVE&&(this.playerMessageTimeout=setTimeout(()=>{this.playerMessageContainer.classList.remove("visible"),setTimeout(()=>{this.playerMessageText&&(this.playerMessageText.textContent="")},m.FADE_TIME)},m.DISPLAY_TIME)))}showInitialMessage(){this.showGameMessage("Before you lies the vast Antarctic expanse, untamed and unforgiving. The freezing wind howls a challenge promising either immortal glory or eternal rest beneath the ice.",m.TYPES.NARRATIVE)}showDeathMessage(e="exposure"){const s={exposure:"The bitter Antarctic winds howl a mournful dirge as your frozen form becomes one with the endless white expanse. Your journey ends here, but the South Pole remains, waiting for the next brave soul to challenge its deadly embrace.",blizzard:"Lost in the blizzard, you fade into the endless white...",whiteout:"In the whiteout, all sense of direction vanishes as consciousness slips away..."};this.showGameMessage(s[e],m.TYPES.NARRATIVE)}showVictoryMessage(){this.showGameMessage("Against all odds, you've done it! You've reached the South Pole and returned to tell the tale. Your name will be forever etched in the annals of polar exploration.",m.TYPES.NARRATIVE),this.showPlayerMessage("Victory! You have conquered Antarctica!",m.TYPES.NARRATIVE),this.gameMessageContainer&&this.gameMessageContainer.classList.add("victory")}updateCurrentLocationInfo(){const{q:e,r:s}=this.store.playerPosition,i=document.querySelector(`polygon[data-q="${e}"][data-r="${s}"]`);if(!i)return;const r=i.getAttribute("data-terrain"),o=r==="BASE_CAMP"?g.BASE_CAMP:r==="SOUTH_POLE"?g.SOUTH_POLE:T[r];o&&this.showGameMessage(`<h3>${o.name}</h3>
            <p><em>${o.quote}</em></p>`,m.TYPES.TERRAIN)}showWeatherMessage(e){const s={BLIZZARD:"A blizzard sweeps in, obscuring your view...",WHITEOUT:"The air grows thick with snow...",BLIZZARD_END:"The blizzard subsides, your surroundings becoming familiar once again...",WHITEOUT_END:"The white out phenomenon clears, but nothing looks familiar anymore..."};s[e]&&this.showPlayerMessage(s[e],m.TYPES.WEATHER)}clearMessages(){this.gameMessageElement&&(this.gameMessageElement.innerHTML="",this.gameMessageContainer.classList.remove("has-message"),this.gameMessageContainer.classList.remove("terrain-info"),this.gameMessageContainer.classList.remove("narrative")),this.playerMessageContainer&&this.playerMessageContainer.classList.remove("visible"),this.playerMessageTimeout&&clearTimeout(this.playerMessageTimeout),this.currentMessage=""}}const f={getAdjacentHexes(t){return[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}].map(s=>({q:t.q+s.q,r:t.r+s.r}))},isHexVisible(t){if(a.game.world.visitedHexes.has(t))return!0;if(d.current.type==="WHITEOUT"){const[e,s]=t.split(",").map(Number);return this.getHexDistance({q:e,r:s},a.playerPosition)<=O.WHITEOUT.visibility.range}return d.current.type==="BLIZZARD"?d.visibility.temporaryFog.has(t):a.game.world.visibleHexes.has(t)},getHexDistance(t,e){return(Math.abs(t.q-e.q)+Math.abs(t.q+t.r-e.q-e.r)+Math.abs(t.r-e.r))/2},updateVisibility(t=!1){this.updateVisibleHexes(),document.querySelectorAll(".fog").forEach(s=>{const i=parseInt(s.getAttribute("data-q")),r=parseInt(s.getAttribute("data-r")),o=`${i},${r}`,n=this.isHexVisible(o);if(t)if(d.current.type==="BLIZZARD"){const h=n?"0.8":"1";s.setAttribute("fill-opacity",h),n&&d.visibility.affectedHexes.add(o)}else d.current.type==="WHITEOUT"&&s.setAttribute("fill-opacity","1");else s.setAttribute("fill-opacity",n?"0":"1")}),t&&d.current.type==="BLIZZARD"&&this.updateTemporaryFog()},updateTemporaryFog(){const t=this.getAdjacentHexes(a.playerPosition);d.visibility.temporaryFog.add(`${a.playerPosition.q},${a.playerPosition.r}`),t.forEach(e=>{d.visibility.temporaryFog.add(`${e.q},${e.r}`)})},isAdjacent(t,e){return this.getHexDistance(t,e)===1},updateVisibleHexes(){a.game.world.visibleHexes.clear(),a.game.world.visibleHexes.add(`${a.playerPosition.q},${a.playerPosition.r}`),this.getAdjacentHexes(a.playerPosition).forEach(e=>{a.game.world.visibleHexes.add(`${e.q},${e.r}`)})}},Z=()=>{const t=Math.max(-12,0),e=Math.min(l.SIZE,l.SIZE- -12),i={q:t+Math.floor(Math.random()*(e-t+1)),r:-12},r=Math.floor(l.SIZE*.2);let o,n;do o=Math.floor(Math.random()*(r*2+1))-r,n=Math.floor(Math.random()*(r*2+1))-r;while(o===i.q&&n===i.r);const h={q:o,r:n},A={};for(let u=-12;u<=l.SIZE;u++)for(let y=-12;y<=l.SIZE;y++)if(Math.abs(u+y)<=l.SIZE){if(u===i.q&&y===i.r||u===h.q&&y===h.r)continue;A[`${u},${y}`]=_()}return{baseCamp:i,southPole:h,terrain:A,visitedHexes:new Set([`${i.q},${i.r}`]),visibleHexes:new Set}},b={BUTTON_ID:"restart-button",GAME_CONTAINER_ID:"game-container",DEATH_MESSAGES:{HEALTH:"You've succumbed to the harsh Antarctic conditions...",BLIZZARD:"Lost in the blizzard, you fade into the endless white...",WHITEOUT:"In the whiteout, all sense of direction vanishes as consciousness slips away..."}};class k{constructor(e,s,i){this.store=e,this.weatherSystem=s,this.statsService=i,this.initRestartButton()}initRestartButton(){const e=document.getElementById(b.BUTTON_ID);e&&e.remove();const s=document.createElement("button");s.id=b.BUTTON_ID,s.className="restart-button hidden",s.textContent="Begin A New Expedition",s.addEventListener("click",()=>this.handleRestart());const i=document.getElementById(b.GAME_CONTAINER_ID);i&&i.appendChild(s)}showRestartButton(){document.getElementById(b.BUTTON_ID)||this.initRestartButton();const s=document.getElementById(b.BUTTON_ID);s&&(s.classList.remove("hidden"),s.style.display="block",s.style.zIndex="1000",s.style.position="absolute",s.onclick||s.addEventListener("click",()=>this.handleRestart()))}hideRestartButton(){const e=document.getElementById(b.BUTTON_ID);e&&(e.classList.add("hidden"),e.style.display="none")}handlePlayerDeath(e="HEALTH"){this.store.game.pauseGame(),this.weatherSystem&&this.weatherSystem.resetWeatherState();const s=b.DEATH_MESSAGES[e]||b.DEATH_MESSAGES.HEALTH;this.store.messages.showPlayerMessage(s,"narrative"),this.showRestartButton()}handleRestart(){this.store.game.resetGame(),this.store.player.resetStats(),this.store.game.world.southPoleVisited=!1,this.store.game.won=!1,this.store.player.position={q:this.store.baseCamp.q,r:this.store.baseCamp.r};const e=document.getElementById("player");e&&e.setAttribute("fill","#0000FF"),this.weatherSystem&&this.weatherSystem.resetWeatherState(),this.hideRestartButton(),this.statsService.updateStatsDisplay(),this.store.messages.showInitialMessage(),this.store.game.running=!0,setTimeout(()=>{this.store.game.running&&!this.store.game.won&&this.weatherSystem.scheduleNextWeather()},5e3)}checkDeathConditions(){if(!(!this.store.game.running||this.store.game.won)&&this.store.player.stats.health<=0){let e="HEALTH";this.store.weather.effects.blizzardActive?e="BLIZZARD":this.store.weather.effects.whiteoutActive&&(e="WHITEOUT"),this.handlePlayerDeath(e)}}}const I={restartSystem:null,init(t){this.restartSystem=t},updateStats(){if(!a.gameRunning||a.gameWon)return;if(a.debug.godModeActive||window.DEBUG&&window.DEBUG.godModeActive){const i=a.player.stats;i.health=100,i.stamina=100,i.hunger=100,this.updateStatsDisplay();return}const t=Date.now(),e=(t-a.player.lastStatUpdate)/1e3;if(e<.05)return;if(a.playerPosition.q===a.baseCamp.q&&a.playerPosition.r===a.baseCamp.r?this.handleBaseCampHealing(e):this.handleFieldConditions(e),a.player.stats.health<=0){this.handleDeath();return}a.player.lastStatUpdate=t,this.updateStatsDisplay()},handleBaseCampHealing(t){const{stats:e}=a.player;e.health=Math.min(c.MAX_VALUE,e.health+c.HEAL_RATE*3*t),e.stamina=Math.min(c.MAX_VALUE,e.stamina+c.STAMINA_RECOVERY_RATE*3*t),e.hunger=Math.min(c.MAX_VALUE,e.hunger+c.HUNGER_DECAY_RATE*3*t)},handleFieldConditions(t){if(a.debug.godModeActive||window.DEBUG&&window.DEBUG.godModeActive)return;const{stats:e}=a.player;let s=1;if(a.weather.current.type==="WHITEOUT"?s=O.WHITEOUT.healthDecayMultiplier:a.weather.current.type==="BLIZZARD"&&(s=O.BLIZZARD.healthDecayMultiplier),e.hunger<=0)this.handleStarvation();else{const o=.5*t*s;e.health=Math.max(0,e.health-o)}(Date.now()-a.player.lastMoveTime)/1e3>2&&(e.stamina=Math.min(c.MAX_VALUE,e.stamina+c.STAMINA_RECOVERY_RATE*t))},handleStarvation(){if(a.debug.godModeActive||window.DEBUG&&window.DEBUG.godModeActive)return;const{stats:t}=a.player;t.health=Math.max(0,t.health-.5),t.stamina=Math.max(0,t.stamina-.5),this.checkStarvationThresholds()},checkStarvationThresholds(){const{health:t}=a.player.stats;new Set([75,50,25,10]).forEach(s=>{if(t<=s&&!a.game.hasShownThreshold(s)){a.game.markThresholdShown(s);const i={75:"Your strength begins to fade as hunger gnaws at you...",50:"The lack of food is taking its toll. Your vision swims...",25:"Every step is agony. The hunger is unbearable...",10:"You can barely move. Death's icy grip tightens..."};a.messages.showPlayerMessage(i[s],P.MESSAGE_TYPES.STATUS)}})},handleDeath(){let t="HEALTH";a.weather.current.type==="WHITEOUT"?t="WHITEOUT":a.weather.current.type==="BLIZZARD"&&(t="BLIZZARD"),this.restartSystem&&this.restartSystem.handlePlayerDeath(t);const e=document.getElementById("player");e&&e.setAttribute("fill","#000066")},updateStatsDisplay(){const{health:t,stamina:e,hunger:s}=a.player.stats,i=document.getElementById("health-bar");i&&(i.style.width=`${t}%`,i.style.backgroundColor=this.getHealthColor(t));const r=document.getElementById("stamina-bar");r&&(r.style.width=`${e}%`,r.style.backgroundColor=this.getStaminaColor(e));const o=document.getElementById("hunger-bar");o&&(o.style.width=`${s}%`,o.style.backgroundColor=this.getHungerColor(s))},getHealthColor(t){return t>66?"#FF0000":t>33?"#FF4500":"#8B0000"},getStaminaColor(t){return t>66?"#2196F3":t>33?"#87CEEB":"#B0E0E6"},getHungerColor(t){return t>66?"#D2691E":t>33?"#CD853F":"#8B4513"}},B={calculateMovementDuration(t=0){const e=C.BASE_DURATION+t*C.STAMINA_FACTOR;return Math.min(Math.max(e,C.MIN_DURATION),C.MAX_DURATION)},async animatePlayerMovement(t,e,s,i,r=0){return new Promise(o=>{const n=document.getElementById("player"),h=document.getElementById("hexGroup");if(!n||!h){console.error("Missing elements:",{player:!!n,hexGroup:!!h}),o();return}const A=this.getHexCenter(t,e),u=this.getHexCenter(s,i),y=this.calculateMovementDuration(r),N=performance.now(),D=z=>{const W=z-N,v=Math.min(W/y,1),L=v<.5?2*v*v:1-Math.pow(-2*v+2,2)/2,R=A.x+(u.x-A.x)*L,x=A.y+(u.y-A.y)*L;n.setAttribute("cx",R),n.setAttribute("cy",x),h.setAttribute("transform",`translate(${-R}, ${-x})`),v<1?requestAnimationFrame(D):o()};requestAnimationFrame(D)})},resetHexColors(){document.querySelectorAll("polygon[data-terrain]").forEach(t=>{const e=t.getAttribute("data-terrain");e==="BASE_CAMP"?t.setAttribute("fill",g.BASE_CAMP.color):e==="SOUTH_POLE"?t.setAttribute("fill",g.SOUTH_POLE.color):t.setAttribute("fill",T[e].color),t.setAttribute("stroke","#ffffff"),t.setAttribute("stroke-width","1")})},async updatePlayerPosition(t,e){if(!a.gameRunning||a.gameWon)return;const s=document.querySelector(`polygon[data-q="${t}"][data-r="${e}"]`);if(!s){console.error("Target hex not found:",{newQ:t,newR:e});return}const i=s.getAttribute("data-terrain"),r=i==="BASE_CAMP"?g.BASE_CAMP:i==="SOUTH_POLE"?g.SOUTH_POLE:T[i],o=a.playerPosition.q,n=a.playerPosition.r;await this.animatePlayerMovement(o,n,t,e,(r==null?void 0:r.staminaCost)||0),a.player.position={q:t,r:e};const h=`${t},${e}`;a.game.world.visitedHexes.add(h),f.getAdjacentHexes({q:t,r:e}).forEach(u=>{const y=`${u.q},${u.r}`;a.game.world.visibleHexes.add(y)}),r!=null&&r.healthRisk&&(a.player.stats.health=Math.max(0,a.player.stats.health-r.healthRisk*100),a.messages.showPlayerMessage("The bitter cold of the ice field bites into you.",P.MESSAGE_TYPES.STATUS)),d.current.type==="BLIZZARD"?(d.methods.updateVisibility(`${t},${e}`,!0),f.updateVisibility(!0)):f.updateVisibility(!1),this.checkVictoryConditions(t,e),a.game.world.selectedHex=null,this.resetHexColors(),this.skipLocationUpdate||a.messages.updateCurrentLocationInfo(),this.skipLocationUpdate=!1},checkVictoryConditions(t,e){const s=t===a.southPole.q&&e===a.southPole.r,i=t===a.baseCamp.q&&e===a.baseCamp.r;s&&!a.game.world.southPoleVisited?(a.game.world.southPoleVisited=!0,this.skipLocationUpdate=!0,a.messages.showGameMessage("At last! Through bitter cold and endless white, you've reached the South Pole! Now the treacherous journey back to base camp awaits...",m.TYPES.NARRATIVE)):a.game.world.southPoleVisited&&i&&(this.skipLocationUpdate=!0,this.handleVictory())},handleVictory(){a.game.won=!0,a.game.running=!1,this.skipLocationUpdate=!0,a.messages.clearMessages(),a.messages.showVictoryMessage();const t=document.getElementById("player");t&&t.setAttribute("fill","#FFD700"),a.restartSystem&&a.restartSystem.showRestartButton()},getHexCenter(t,e){const s=l.HEX_WIDTH,i=l.HEX_HEIGHT,r=s*(t+e/2),o=i*(e*3/4);return{x:r,y:o}},handleHexSelection(t,e,s,i){this.resetHexColors();const r=f.isAdjacent({q:e,r:s},a.playerPosition);if(a.game.world.selectedHex&&a.game.world.selectedHex===t){if(r){const o=C.STAMINA_COST+(i.staminaCost||0);if(i.passable)if(a.player.stats.stamina<o){a.messages.showPlayerMessage("You are too exhausted",P.MESSAGE_TYPES.TERRAIN);const n=document.getElementById("stamina-bar").parentElement;n.classList.add("pulse-warning"),setTimeout(()=>n.classList.remove("pulse-warning"),1500)}else this.handleMovement(e,s,o);else{a.messages.showPlayerMessage(i.description||"This terrain is impassable!",P.MESSAGE_TYPES.TERRAIN);return}}a.game.world.selectedHex=null}else a.game.world.selectedHex=t,t.setAttribute("stroke","#000000"),t.setAttribute("stroke-width","3"),!d.effects.whiteoutPhase&&(!d.effects.blizzardActive||e===a.playerPosition.q&&s===a.playerPosition.r)&&(document.getElementById("game-message").className="terrain-info",document.getElementById("game-message").innerHTML=`
                    <h3>${i.name}</h3>
                    <p><em>${i.quote}</em></p>
                `)},async handleMovement(t,e,s){a.player.stats.stamina-=s,a.player.stats.hunger=Math.max(0,a.player.stats.hunger-5),a.player.stats.hunger<=0,a.player.lastMoveTime=Date.now(),I.updateStatsDisplay(),await this.updatePlayerPosition(t,e)}},w={initializeGrid(){const t=Z();a.player.position={...t.baseCamp},Object.assign(a.game.world,t),this.createHexGrid(),a.game.world.visitedHexes.add(`${a.playerPosition.q},${a.playerPosition.r}`),f.getAdjacentHexes(a.playerPosition).forEach(s=>{a.game.world.visibleHexes.add(`${s.q},${s.r}`)}),f.updateVisibility(!1),a.messages.updateCurrentLocationInfo()},getTerrainType(t,e){if(t===a.game.world.baseCamp.q&&e===a.game.world.baseCamp.r)return"BASE_CAMP";if(t===a.game.world.southPole.q&&e===a.game.world.southPole.r)return"SOUTH_POLE";const s=`${t},${e}`;return a.game.world.terrain[s]||(a.game.world.terrain[s]=_()),a.game.world.terrain[s]},createHexGrid(){const t=document.getElementById("hexGroup");if(!t){console.error("No hexGroup element found");return}for(let e=-12;e<=l.SIZE;e++)for(let s=-12;s<=l.SIZE;s++)Math.abs(e+s)<=l.SIZE&&this.createHexAtPosition(t,e,s);document.querySelectorAll("polygon[data-terrain]").forEach(e=>{e.addEventListener("click",()=>{const s=parseInt(e.getAttribute("data-q")),i=parseInt(e.getAttribute("data-r")),r=e.getAttribute("data-terrain"),o=r==="BASE_CAMP"?g.BASE_CAMP:r==="SOUTH_POLE"?g.SOUTH_POLE:T[r];B.handleHexSelection(e,s,i,o)})}),this.createPlayerMarker(),this.centerViewport()},createHexAtPosition(t,e,s){const i=l.HEX_WIDTH*(e+s/2),r=l.HEX_HEIGHT*(s*3/4),o=this.createTerrainHex(e,s,i,r);t.appendChild(o);const n=this.createFogOverlay(e,s,i,r);t.appendChild(n)},createTerrainHex(t,e,s,i){const r=document.createElementNS("http://www.w3.org/2000/svg","polygon"),o=this.getTerrainType(t,e),n=o==="BASE_CAMP"?g.BASE_CAMP:o==="SOUTH_POLE"?g.SOUTH_POLE:T[o];return r.setAttribute("points",this.createHexPoints(l.HEX_SIZE)),r.setAttribute("transform",`translate(${s}, ${i})`),r.setAttribute("fill",n.color),r.setAttribute("stroke","#ffffff"),r.setAttribute("stroke-width","1"),r.setAttribute("data-q",t),r.setAttribute("data-r",e),r.setAttribute("data-terrain",o),r},createHexPoints(t){const e=[];for(let s=0;s<6;s++){const i=(60*s-30)*Math.PI/180;e.push(`${t*Math.cos(i)},${t*Math.sin(i)}`)}return e.join(" ")},createFogOverlay(t,e,s,i){const r=document.createElementNS("http://www.w3.org/2000/svg","polygon");return r.setAttribute("points",this.createHexPoints(l.HEX_SIZE)),r.setAttribute("transform",`translate(${s}, ${i})`),r.setAttribute("class","fog"),r.setAttribute("data-q",t),r.setAttribute("data-r",e),r.setAttribute("fill-opacity","1"),r.setAttribute("id",`fog-${t},${e}`),r.setAttribute("fill","white"),r},createPlayerMarker(){const t=document.createElementNS("http://www.w3.org/2000/svg","circle"),e=this.getHexCenter(a.playerPosition.q,a.playerPosition.r);t.setAttribute("cx",e.x),t.setAttribute("cy",e.y),t.setAttribute("r",l.HEX_SIZE*.3),t.setAttribute("fill","green"),t.setAttribute("id","player"),t.setAttribute("stroke","white"),t.setAttribute("stroke-width","2"),document.getElementById("hexGroup").appendChild(t)},getHexCenter(t,e){const s=Math.sqrt(3)*l.HEX_SIZE,i=l.HEX_SIZE*2,r=s*(t+e/2),o=i*(e*3/4);return{x:r,y:o}},centerViewport(){const t=document.getElementById("hexGroup"),e=this.getHexCenter(a.playerPosition.q,a.playerPosition.r);t.setAttribute("transform",`translate(${-e.x}, ${-e.y})`)},createHexGrid(){const t=document.getElementById("hexGroup");if(!t){console.error("No hexGroup element found");return}for(let e=-12;e<=l.SIZE;e++)for(let s=-12;s<=l.SIZE;s++)Math.abs(e+s)<=l.SIZE&&this.createHexAtPosition(t,e,s);document.querySelectorAll("polygon[data-terrain]").forEach(e=>{e.addEventListener("click",()=>{const s=parseInt(e.getAttribute("data-q")),i=parseInt(e.getAttribute("data-r")),r=e.getAttribute("data-terrain"),o=r==="BASE_CAMP"?g.BASE_CAMP:r==="SOUTH_POLE"?g.SOUTH_POLE:T[r];B.handleHexSelection(e,s,i,o)})}),this.createPlayerMarker(),this.centerViewport()}};Object.getOwnPropertyNames(w).filter(t=>typeof w[t]=="function").forEach(t=>{w[t]=w[t].bind(w)});class V{constructor(e,s){this.store=e,this.WeatherSystem=s,this.godModeActive=!1,this.createGodModeIndicator(),this.handleDebugCommand=this.handleDebugCommand.bind(this),document.addEventListener("keydown",this.handleDebugCommand)}showDebugMessage(e){const s=document.getElementById("message-container");if(!s)return;const i=document.createElement("p");i.className="debug-message",i.textContent=e,i.style.color="yellow",i.style.fontWeight="bold",s.querySelectorAll(".debug-message").forEach(o=>o.remove()),s.appendChild(i),setTimeout(()=>i.remove(),2e3)}toggleFogOfWar(){this.fogRevealActive?(this.store.game.world.visitedHexes=new Set(this.originalVisitedHexes),document.querySelectorAll(".fog").forEach(e=>{const s=parseInt(e.getAttribute("data-q")),i=parseInt(e.getAttribute("data-r")),r=`${s},${i}`;this.store.game.world.visitedHexes.has(r)||e.setAttribute("fill-opacity","1")})):(this.originalVisitedHexes=new Set(this.store.game.world.visitedHexes),document.querySelectorAll(".fog").forEach(s=>{const i=parseInt(s.getAttribute("data-q")),r=parseInt(s.getAttribute("data-r"));s.setAttribute("fill-opacity","0"),this.store.game.world.visitedHexes.add(`${i},${r}`)})),this.fogRevealActive=!this.fogRevealActive,this.showDebugMessage(this.fogRevealActive?"FOG OF WAR DISABLED":"FOG OF WAR ENABLED")}createGodModeIndicator(){const e=document.createElement("div");e.id="god-mode-indicator",e.style.position="fixed",e.style.top="10px",e.style.right="10px",e.style.backgroundColor="rgba(255, 215, 0, 0.8)",e.style.padding="5px 10px",e.style.borderRadius="5px",e.style.fontWeight="bold",e.style.display="none",e.textContent="GOD MODE",document.body.appendChild(e)}toggleGodMode(){if(this.store.debug.godModeActive=!this.store.debug.godModeActive,this.godModeActive=this.store.debug.godModeActive,this.godModeActive){const s=this.store.player.stats;s.health=100,s.stamina=100,s.hunger=100}this.showDebugMessage(this.godModeActive?"GOD MODE ACTIVATED":"GOD MODE DEACTIVATED");const e=document.getElementById("god-mode-indicator");e&&(e.style.display=this.godModeActive?"block":"none")}cleanup(){document.removeEventListener("keydown",this.handleDebugCommand);const e=document.getElementById("god-mode-indicator");e&&e.remove()}adjustZoom(e){const s=document.getElementById("gameGrid");if(!s)return;const i=[.75,1,1.25,1.5,2,3],r=i.findIndex(o=>Math.abs(this.zoomLevel-o)<.01);e==="in"&&r>0?this.zoomLevel=i[r-1]:e==="out"&&r<i.length-1&&(this.zoomLevel=i[r+1]),s.style.transform=`scale(${this.zoomLevel})`,this.showDebugMessage(`ZOOM: ${this.zoomLevel.toFixed(2)}x`)}handleDebugCommand(e){if(e.ctrlKey&&e.altKey)switch(e.preventDefault(),e.stopPropagation(),e.key){case"f":this.toggleFogOfWar();break;case"g":this.toggleGodMode();break;case"b":this.WeatherSystem.triggerBlizzard(),this.showDebugMessage("TRIGGERED BLIZZARD");break;case"w":this.WeatherSystem.triggerWhiteout(),this.showDebugMessage("TRIGGERED WHITEOUT");break;case"c":this.WeatherSystem.resetWeatherState(),this.showDebugMessage("CLEARED WEATHER");break;case"-":this.adjustZoom("out");break;case"=":this.adjustZoom("in");break;case"h":if(this.godModeActive)this.showDebugMessage("HEALTH REDUCTION BLOCKED BY GOD MODE");else{const s=this.store.player.stats.health,i=20;this.store.player.stats.health=Math.max(0,s-i),this.showDebugMessage(`HEALTH REDUCED BY ${i}%`)}break}}cleanup(){document.removeEventListener("keydown",this.handleDebugCommand)}}const $={debugManager:null,init(){this.initializeState(),this.messageSystem=new F(a),a.messages=this.messageSystem,this.weatherSystem=new G(a,this.messageSystem,f,I),this.restartSystem=new k(a,this.weatherSystem,I),a.restartSystem=this.restartSystem,I.init(this.restartSystem),w.initializeGrid(),this.setupDebugFeatures(),this.startGameLoops(),a.messages.showInitialMessage()},initializeState(){a.game.world.visitedHexes.add(`${a.playerPosition.q},${a.playerPosition.r}`),f.getAdjacentHexes(a.playerPosition).forEach(e=>{a.game.world.visibleHexes.add(`${e.q},${e.r}`)})},startGameLoops(){setInterval(()=>I.updateStats(),50);const t=this;setTimeout(()=>{a.gameRunning&&!a.gameWon&&t.weatherSystem.scheduleNextWeather()},5e3)},setupDebugFeatures(){this.debugManager&&this.debugManager.cleanup(),this.debugManager=new V(a,this.weatherSystem),window.DEBUG={...a.DEBUG,triggerBlizzard:()=>this.weatherSystem.triggerBlizzard(),triggerWhiteout:()=>this.weatherSystem.triggerWhiteout(),getGameState:()=>({...a.game}),getWeatherState:()=>({...a.weather}),toggleFogOfWar:()=>this.debugManager.toggleFogOfWar(),toggleGodMode:()=>this.debugManager.toggleGodMode(),adjustZoom:t=>this.debugManager.adjustZoom(t)}},handleRestart(){a.game.resetGame(),a.player.resetStats(),w.initializeGrid(),f.updateVisibility(!1),this.WeatherSystem.resetWeatherState(),this.debugManager&&this.debugManager.cleanup(),this.setupDebugFeatures(),I.updateStatsDisplay(),a.messages.showInitialMessage(),setTimeout(()=>{a.gameRunning&&!a.gameWon&&this.WeatherSystem.scheduleNextWeather()},5e3)}};document.addEventListener("DOMContentLoaded",()=>{$.init()});
