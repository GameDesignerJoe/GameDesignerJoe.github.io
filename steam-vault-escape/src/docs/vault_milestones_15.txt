Steam Vault Escape - Milestone Plan v1.5
Implementation Phases
This plan breaks down the v1.5 implementation into manageable milestones for Cline to execute sequentially.

---

MILESTONE 0: Foundation Refactor (v1.0 ‚Üí v1.5 Bridge) ‚úÖ COMPLETE
Goal: Prepare the codebase for v1.5 by removing obsolete systems, adding new APIs, and updating core data structures.

Tasks:

1. ‚úÖ Remove Vault Controller
   - File: lib/constants.ts
     * Delete VAULT_CONTROLLER constant
   - File: lib/vault-logic.ts
     * Remove getVaultController() function
     * Remove references to 'vault-controller' in classifyGame()
   - File: app/page.tsx
     * Remove all Vault Controller initialization code
     * Remove from featured game logic

2. ‚úÖ Add API Routes for Metadata
   - File: app/api/steamspy/route.ts (NEW)
     ‚úÖ Create SteamSpy API route
     ‚úÖ Fetch rating (positive/negative ratio)
     ‚úÖ Fetch median_forever for hours-to-beat estimate
     ‚úÖ Fetch tags for categorization
   
   - File: app/api/steam-store/route.ts (NEW)
     ‚úÖ Create Steam Store API route
     ‚úÖ Fetch Metacritic score (game.metacritic?.score)
     ‚úÖ Fetch recommendations count as fallback rating

3. ‚úÖ Update Type Definitions
   - File: types/steam.ts
     * Add metacritic?: number
     * Add hoursTobeat?: number (from SteamSpy median_forever)
     * Add tags?: string[]
     * Add recommendations?: number
   
   - File: types/vault.ts
     * Remove GameState type (replaced by pool membership)
     * Add new types:
       ```typescript
       export type GameTier = 'cheap' | 'moderate' | 'epic';
       
       export interface GameProgress {
         currentPower: number;
         maxPower: number;
         isDrained: boolean;
         lastPlaytime: number;
       }
       
       export interface ShopSlot {
         appId: number | null;
         tier: GameTier | null;
       }
       ```
     * Update VaultState interface:
       ```typescript
       export interface VaultState {
         // Dual currency
         collectionPower: number;
         liberationKeys: number;
         
         // Three pools (arrays of app IDs)
         pool1_unlocked: number[];
         pool2_hidden: number[];
         pool3_keyGames: number[];
         
         // Shop state
         shopSlots: ShopSlot[];
         
         // Game progress tracking
         gameProgress: { [appId: number]: GameProgress };
         
         // Metadata
         lastSync: number;
         steamId: string;
         version: string;
       }
       ```

4. ‚úÖ Update Formulas & Constants
   - File: lib/constants.ts
     ‚úÖ Remove old formulas (unlockCost, passiveRate, clickValue, liberationBonus)
     ‚úÖ Add new v1.5 formulas:
       ```typescript
       export const FORMULAS = {
         // Unlock cost: Metacritic √ó Hours to Beat
         unlockCost: (metacritic: number, hoursTobeat: number): number => 
           Math.floor(metacritic * hoursTobeat),
         
         // Click value: Steam hours played
         clickValue: (steamMinutes: number): number => 
           Math.floor(steamMinutes / 60),
         
         // Max power: Click value √ó 100
         maxPower: (clickValue: number): number => 
           clickValue * 100,
         
         // Refresh cost: Metacritic √∑ 10 (rounded up)
         refreshCost: (metacritic: number): number => 
           Math.ceil(metacritic / 10),
         
         // Key reward: Metacritic score (or fallback)
         keyReward: (metacritic: number): number => 
           metacritic || 70,
         
         // Tier classification
         getTier: (unlockCost: number): GameTier => {
           if (unlockCost < 1000) return 'cheap';
           if (unlockCost < 3000) return 'moderate';
           return 'epic';
         }
       };
       ```
     * Add new thresholds:
       ```typescript
       export const THRESHOLDS = {
         KEY_GAME_MIN_PLAYTIME: 30, // Minutes
         DRAW_COST: 10, // Keys
         REDRAW_COST: 5, // Keys
         STARTING_GAME_METACRITIC_MIN: 70,
         STARTING_GAME_METACRITIC_MAX: 79,
         STARTING_GAME_HOURS_MIN: 5,
         STARTING_GAME_HOURS_MAX: 10,
         DEFAULT_METACRITIC: 70,
         DEFAULT_HOURS_TO_BEAT: 30,
       };
       ```

5. ‚úÖ Update Storage Structure
   - File: lib/storage.ts
     ‚úÖ Update StoredState interface to match new VaultState
     ‚úÖ Update saveToStorage() to handle dual currency
     ‚úÖ Update loadFromStorage() to handle new structure
     ‚úÖ Add version migration logic (v1.0 saves should be cleared)

6. ‚úÖ Create Utility Functions
   - File: lib/game-utils.ts (NEW)
     ‚úÖ Function: enrichGameWithMetadata(game: SteamGame): Promise<SteamGame>
       - Fetch Metacritic from Steam Store API
       - Fetch hours-to-beat from SteamSpy
       - Calculate unlock cost
       - Determine tier
       - Return enriched game
     
     ‚úÖ Function: selectStartingGame(games: SteamGame[]): SteamGame | null
       - Filter: Metacritic 70-79, 5-10 hours played
       - Fallback: Any game with 5-10 hours played
       - Fallback: Lowest playtime game
       - Return selected game or null

7. ‚úÖ Audit Existing Code
   - Keep (reusable):
     ‚úÖ Steam API integration (app/api/steam-library/route.ts)
     ‚úÖ Image handling (lib/steam-images.ts)
     ‚úÖ Virtual scrolling implementation
     ‚úÖ localStorage patterns
     ‚úÖ Loading/error states
     ‚úÖ Dev panel
   
   - Modify:
     üîß app/page.tsx (complete UI restructure for 3 sections)
     üîß lib/vault-logic.ts (new pool-based logic)
     üîß types/* (new interfaces)
   
   - Remove:
     ‚ùå Featured game clicking system
     ‚ùå Single click card
     ‚ùå Vault Controller references
     ‚ùå Victory detection (moves to Milestone 8)
     ‚ùå Old passive income system

8. Test Foundation
   - Verify API routes work:
     * Test SteamSpy route with a game
     * Test Steam Store route with a game
     * Verify Metacritic scores retrieved
     * Verify hours-to-beat calculated
   
   - Verify formulas:
     * Calculate unlock costs for sample games
     * Verify tier classification
     * Test refresh cost calculation
   
   - Verify storage:
     * Save new structure to localStorage
     * Load and verify data integrity
     * Confirm version migration clears old saves

Success Criteria:

‚úÖ Vault Controller removed from codebase
‚úÖ SteamSpy & Steam Store API routes functional
‚úÖ Type definitions updated for v1.5
‚úÖ New formulas implemented and tested
‚úÖ Storage structure updated
‚úÖ Starting game selection logic created
‚úÖ No TypeScript errors
‚úÖ Foundation ready for Milestone 1

---

MILESTONE 1: Three-Pool Foundation ‚úÖ COMPLETE
Goal: Establish the core three-pool system and data structures.
Tasks:

‚úÖ Create Pool Manager
   - File: lib/pool-manager.ts
   ‚úÖ Implement initializePools(), promoteKeyGame(), unlockGame() functions
   ‚úÖ Logic for selecting starting game (70s Metacritic, 5-10 hours)
   ‚úÖ Helper functions: getGamesInPool(), needsPoolInitialization(), getPoolStats()

‚úÖ Update Save Data Structure
   - File: lib/storage.ts
   ‚úÖ VaultState interface with three pool arrays
   ‚úÖ shopSlots array added
   ‚úÖ gameProgress map added
   ‚úÖ saveToStorage() and loadFromStorage() updated

‚úÖ Initialize Pools on Load
   - File: app/page.tsx
   ‚úÖ On Steam library fetch, call initializePools()
   ‚úÖ Store pools in VaultState
   ‚úÖ Save to localStorage

‚úÖ Test Pool Initialization
   ‚úÖ Verified starting game selected correctly (Sid Meier's Pirates!)
   ‚úÖ Verified Pool 1 has 1 game
   ‚úÖ Verified Pool 2 has 239 remaining played games  
   ‚úÖ Verified Pool 3 has 314 never-played games
   ‚úÖ Console logs confirm proper pool distribution

Success Criteria:

‚úÖ Three pools correctly populated
‚úÖ Starting game meets criteria
‚úÖ Pools saved to localStorage


MILESTONE 2: Shop System with 5 Slots
Goal: Replace single-click card with 5-slot shop displaying locked games.
Tasks:

Create Shop Manager

File: src/lib/shop-manager.ts
Implement ShopManager class
Method: initializeShop() with curated tier distribution
Method: categorizeByTier() based on unlock cost
Method: drawNewGame() with weighted random


Calculate Unlock Costs

File: src/lib/game-utils.ts
Function: calculateUnlockCost(metacritic, hoursTobeat)
Returns: { power: number, tier: 'cheap' | 'moderate' | 'epic' }
Tier thresholds: <1000, 1000-3000, 3000+


Update UI Layout

File: src/app/page.tsx
Remove single click card
Add "Unlock with Collection Power" section
Display 5 shop slots horizontally
Each slot shows: Game art, name, Metacritic, unlock cost
Add "Unlock" button (disabled if not enough power)


Implement Unlock Logic

On "Unlock" click:

Check if collectionPower >= unlockCost
Deduct power
Move game from Pool 2 ‚Üí Pool 1
Empty shop slot
Initialize game progress
Save to localStorage




Display Empty Slots

Empty slot shows: "üîí Spend 10 Keys to Draw New Game"
Disabled if liberationKeys < 10
Click opens Draw UI (Milestone 4)



Success Criteria:

‚úÖ 5 shop slots display locked games
‚úÖ Unlock costs calculated correctly
‚úÖ Unlock button works
‚úÖ Games move from shop to Game Library
‚úÖ Empty slots displayed correctly


MILESTONE 3: Game Library with Click & Drain
Goal: Display unlocked games, implement click mechanics, and drain system.
Tasks:

Create Game Library Section

File: src/app/page.tsx
Add "Game Library" section above shop
Display all Pool 1 games as clickable cards
Sort by click value (highest first)
Each card shows: Game art, name, click value, progress bar


Implement Click Handler

File: src/lib/click-manager.ts
Class: ClickManager
Method: handleClick(appId, game, progress)
Calculate power gained = Math.floor(playtime_forever / 60)
Check if drained: currentPower >= maxPower
Return: { powerGained, isDrained }


Update Game Progress

On click:

Add powerGained to collectionPower
Update gameProgress[appId].currentPower
If drained, set gameProgress[appId].isDrained = true
Save to localStorage
Re-render card




Display Progress Bars

Each game card shows progress: currentPower / maxPower
Visual progress bar: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë
Text: "4,250 / 15,000" below progress bar


Drained State

When isDrained = true:

Card shows dark overlay
Display: "‚ö†Ô∏è DRAINED"
Calculate refresh cost: Math.ceil(metacritic / 10) keys
Show "Refresh for X üîë" button
Clicking is disabled




Refresh Logic

On "Refresh" click:

Check if liberationKeys >= refreshCost
Deduct keys
Reset: currentPower = 0, isDrained = false
Save to localStorage
Re-render card





Success Criteria:

‚úÖ Game Library displays Pool 1 games
‚úÖ Clicking generates power
‚úÖ Progress bars update correctly
‚úÖ Games drain at correct threshold
‚úÖ Drained state displays correctly
‚úÖ Refresh button works


MILESTONE 4: Draw New Game UI
Goal: Implement slot machine interface for drawing games from Pool 2.
Tasks:

Create Draw Modal Component

File: src/components/DrawModal.tsx
Modal overlay with 3 card backs
Card backs are clickable
User clicks one ‚Üí reveal animation
Shows drawn game details
"Accept" or "Redraw for 5 üîë" buttons


Implement Draw Logic

File: src/lib/draw-ui-manager.ts
Class: DrawUIManager
Method: showDrawInterface(slotIndex, pool2, games)
Pre-determine game using shopManager.drawNewGame()
Return: { appId, game }


Connect to Empty Slots

On empty slot click:

Check if liberationKeys >= 10
Open DrawModal
Pass slotIndex and targetTier
On card back click:

Play reveal animation
Show drawn game
Deduct 10 keys
Fill shop slot with game






Redraw Logic

On "Redraw" click:

Check if liberationKeys >= 5
Deduct 5 keys
Call drawUIManager.redraw()
Show new game reveal
Can redraw unlimited times (5 keys each)




Weighted Draw Implementation

Use shopManager.drawNewGame() with tier targeting
Log draws to console for debugging
Verify weights: 70%/20%/10% distribution



Success Criteria:

‚úÖ Empty slot opens Draw Modal
‚úÖ 3 card backs display
‚úÖ Clicking card reveals game
‚úÖ Drawn game fills shop slot
‚úÖ Redraw works and costs 5 keys
‚úÖ Weighted targeting works correctly


MILESTONE 5: Key Games Section
Goal: Display all never-played games with key rewards, click to launch Steam.
Tasks:

Create Key Games Section

File: src/app/page.tsx
Add "Key Games" section at bottom
Grid layout for all Pool 3 games
Each card shows: Full game art, title, key value


Calculate Key Values

Key value = Metacritic score
Display as: "üîë 87 Keys"
If no Metacritic, default to 70


Click to Launch Steam

On card click: Open steam://store/{appId} in new window
This launches Steam app to game's store page
Hover text: "Click to launch Steam"


Visual Design

Full-color game art (not locked/darkened)
Larger cards than shop slots
Sort by key value (highest first) or alphabetically



Success Criteria:

‚úÖ All Pool 3 games displayed
‚úÖ Key values shown correctly
‚úÖ Clicking opens Steam app
‚úÖ Grid layout responsive


MILESTONE 6: Key Game Detection & Rewards
Goal: Detect when player has played a Key Game, award keys, move to Pool 2.
Tasks:

Create Detection System

File: src/lib/key-game-detector.ts
Class: KeyGameDetector
Method: detectNewlyPlayed(steamId, pool3, lastPlaytimes)
Compare current Steam playtime vs cached playtime
If delta >= 30 minutes, game was played


Store Last Playtimes

In gameProgress: Add lastPlaytime: number field
Update on every Steam API fetch
Use to calculate delta


Award Keys on Return

On Steam library re-fetch:

Call keyGameDetector.detectNewlyPlayed()
For each newly played game:

Award keys = Metacritic score
Move game Pool 3 ‚Üí Pool 2
Show celebration notification
Auto-refresh all drained games (call clickManager.autoRefreshAll())






Celebration Notification

File: src/components/CelebrationToast.tsx
Toast notification: "üéâ You played Hades! +93 üîë Keys earned!"
Auto-dismiss after 5 seconds
Multiple toasts if multiple games played


Auto-Refresh All Drained

File: src/lib/click-manager.ts
Method: autoRefreshAll(gameProgress)
Loop through all game progress
If isDrained = true, reset: currentPower = 0, isDrained = false
Free refresh (no key cost)


Periodic Sync

On component mount, check if lastSync > 5 minutes ago
If yes, re-fetch Steam library
Run detection system
Update UI



Success Criteria:

‚úÖ Playing Key Game detected correctly
‚úÖ Keys awarded = Metacritic score
‚úÖ Game moves Pool 3 ‚Üí Pool 2
‚úÖ Celebration notification shown
‚úÖ All drained games auto-refresh
‚úÖ Sync runs periodically


MILESTONE 7: UI Polish & Animations
Goal: Add visual polish, animations, and improved UX.
Tasks:

Card Reveal Animation

DrawModal card flip: 3D flip animation (CSS transform: rotateY())
Duration: 500ms
Easing: ease-out


Progress Bar Animation

Smooth width transition when clicking
Color shift when approaching drain (green ‚Üí yellow ‚Üí red)


Tier Visual Differentiation

Cheap games: Gray/silver border
Moderate games: Blue/purple border with subtle glow
Epic games: Gold/orange border with strong glow


Hover States

Game cards: Lift on hover (transform: translateY(-4px))
Buttons: Brightness increase
Smooth transitions (200ms)


Empty Slot Visual

Dashed border for empty slots
Lock icon centered
Subtle pulse animation on hover


Drained Game Visual

Dark overlay (50% opacity)
Desaturate game art (grayscale filter)
Red border to indicate attention needed


Loading States

Skeleton loading for game cards during fetch
Spinner for Draw UI
Disable buttons during operations


Responsive Design

Stack shop slots vertically on mobile
Reduce card sizes on small screens
Collapsible sections for mobile



Success Criteria:

‚úÖ Animations smooth and performant
‚úÖ Tiers visually distinct
‚úÖ Hover states engaging
‚úÖ Loading states clear
‚úÖ Mobile-friendly layout


MILESTONE 8: Testing & Bug Fixes
Goal: Comprehensive testing and bug fixes before deployment.
Test Cases:

Pool Transitions

 Starting game selected correctly
 Unlocking moves game Pool 2 ‚Üí Pool 1
 Playing Key Game moves Pool 3 ‚Üí Pool 2
 No games appear in multiple pools


Shop Mechanics

 Initial shop has correct tier distribution
 Unlock costs calculated correctly
 Unlocking empties slot
 Draw fills empty slot with correct tier
 Redraw gives different game


Click & Drain

 Clicks generate correct power
 Progress bars update correctly
 Games drain at correct threshold
 Refresh costs calculated correctly
 Manual refresh works


Key Game Detection

 Playing game for 30+ min detected
 Keys awarded = Metacritic score
 Game moves to Pool 2
 Auto-refresh triggers
 Celebration notification shows


Edge Cases

 Pool 2 empty: Draw shows "No games available"
 Pool 3 empty: Key Games shows "All games played!"
 Not enough keys: Buttons disabled
 Not enough power: Unlock disabled
 Private Steam profile: Error message


localStorage

 Save/load works correctly
 Pools persist across sessions
 Progress persists correctly
 Cache expiration works


Performance

 Large libraries (500+ games) load quickly
 Clicking is responsive (no lag)
 Draw UI smooth
 No memory leaks



Bug Fixes:

Fix any issues discovered during testing
Handle edge cases gracefully
Improve error messages
Optimize performance bottlenecks

Success Criteria:

‚úÖ All test cases pass
‚úÖ No critical bugs
‚úÖ Performance acceptable
‚úÖ Error handling robust


MILESTONE 9: Deployment & Documentation
Goal: Deploy to Vercel and finalize documentation.
Tasks:

Environment Setup

Verify STEAM_API_KEY in Vercel environment variables
Test production build locally: npm run build
Check for TypeScript errors


Deploy to Vercel

Push to GitHub main branch
Verify auto-deploy triggers
Test on live URL: steam-vault-escape.vercel.app


User Documentation

File: README.md
How to use the app
How to find Steam ID
How the three pools work
How to earn keys


Developer Documentation

Code comments for complex logic
Architecture overview
How to add new features
Testing instructions


Post-Launch Monitoring

Check Vercel logs for errors
Monitor user feedback
Track usage metrics (if available)



Success Criteria:

‚úÖ App deployed and accessible
‚úÖ No errors in production
‚úÖ Documentation complete
‚úÖ Ready for user testing


MILESTONE 10: Future Enhancements (Post-v1.5)
Goal: Plan and implement additional features based on user feedback.
Potential Features:

Passive Key Generation

Earn 1 key per hour of total library playtime
Incentivizes playing anything, not just Key Games


Daily Challenges

"Play a horror game today" ‚Üí Bonus keys
"Unlock 3 games" ‚Üí Bonus power multiplier


Collection Milestones

Unlock all RPGs ‚Üí Permanent +10% power bonus
Play 50 Key Games ‚Üí Unlock special tier


Bulk Operations

"Refresh All Drained" button (costs total refresh cost)
"Draw 5 Games" button (costs 50 keys, fills all empty slots)


Friend Leaderboards

Compare unlock progress with Steam friends
"Who played more Key Games this week?"


Prestige System

Reset all progress for permanent bonuses
Prestige levels with cosmetic rewards


Enhanced Analytics

Graphs of progress over time
Genre breakdown of library
Cost-per-hour analysis



Implementation: Based on user feedback and priorities after v1.5 launch.
