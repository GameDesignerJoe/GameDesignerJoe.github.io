Steam Vault Escape - Milestone Plan v1.5
Implementation Phases
This plan breaks down the v1.5 implementation into manageable milestones for Cline to execute sequentially.

---

MILESTONE 0: Foundation Refactor (v1.0 â†’ v1.5 Bridge) âœ… COMPLETE
Goal: Prepare the codebase for v1.5 by removing obsolete systems, adding new APIs, and updating core data structures.

Tasks:

1. âœ… Remove Vault Controller
   - File: lib/constants.ts
     * Delete VAULT_CONTROLLER constant
   - File: lib/vault-logic.ts
     * Remove getVaultController() function
     * Remove references to 'vault-controller' in classifyGame()
   - File: app/page.tsx
     * Remove all Vault Controller initialization code
     * Remove from featured game logic

2. âœ… Add API Routes for Metadata
   - File: app/api/steamspy/route.ts (NEW)
     âœ… Create SteamSpy API route
     âœ… Fetch rating (positive/negative ratio)
     âœ… Fetch median_forever for hours-to-beat estimate
     âœ… Fetch tags for categorization
   
   - File: app/api/steam-store/route.ts (NEW)
     âœ… Create Steam Store API route
     âœ… Fetch Metacritic score (game.metacritic?.score)
     âœ… Fetch recommendations count as fallback rating

3. âœ… Update Type Definitions
   - File: types/steam.ts
     * Add metacritic?: number
     * Add hoursTobeat?: number (from SteamSpy median_forever)
     * Add tags?: string[]
     * Add recommendations?: number
   
   - File: types/vault.ts
     * Remove GameState type (replaced by pool membership)
     * Add new types:
       ```typescript
       export type GameTier = 'cheap' | 'moderate' | 'epic';
       
       export interface GameProgress {
         currentPower: number;
         maxPower: number;
         isDrained: boolean;
         lastPlaytime: number;
       }
       
       export interface ShopSlot {
         appId: number | null;
         tier: GameTier | null;
       }
       ```
     * Update VaultState interface:
       ```typescript
       export interface VaultState {
         // Dual currency
         collectionPower: number;
         liberationKeys: number;
         
         // Three pools (arrays of app IDs)
         pool1_unlocked: number[];
         pool2_hidden: number[];
         pool3_keyGames: number[];
         
         // Shop state
         shopSlots: ShopSlot[];
         
         // Game progress tracking
         gameProgress: { [appId: number]: GameProgress };
         
         // Metadata
         lastSync: number;
         steamId: string;
         version: string;
       }
       ```

4. âœ… Update Formulas & Constants
   - File: lib/constants.ts
     âœ… Remove old formulas (unlockCost, passiveRate, clickValue, liberationBonus)
     âœ… Add new v1.5 formulas:
       ```typescript
       export const FORMULAS = {
         // Unlock cost: Metacritic Ã— Hours to Beat
         unlockCost: (metacritic: number, hoursTobeat: number): number => 
           Math.floor(metacritic * hoursTobeat),
         
         // Click value: Steam hours played
         clickValue: (steamMinutes: number): number => 
           Math.floor(steamMinutes / 60),
         
         // Max power: Click value Ã— 100
         maxPower: (clickValue: number): number => 
           clickValue * 100,
         
         // Refresh cost: Metacritic Ã· 10 (rounded up)
         refreshCost: (metacritic: number): number => 
           Math.ceil(metacritic / 10),
         
         // Key reward: Metacritic score (or fallback)
         keyReward: (metacritic: number): number => 
           metacritic || 70,
         
         // Tier classification
         getTier: (unlockCost: number): GameTier => {
           if (unlockCost < 1000) return 'cheap';
           if (unlockCost < 3000) return 'moderate';
           return 'epic';
         }
       };
       ```
     * Add new thresholds:
       ```typescript
       export const THRESHOLDS = {
         KEY_GAME_MIN_PLAYTIME: 30, // Minutes
         DRAW_COST: 10, // Keys
         REDRAW_COST: 5, // Keys
         STARTING_GAME_METACRITIC_MIN: 70,
         STARTING_GAME_METACRITIC_MAX: 79,
         STARTING_GAME_HOURS_MIN: 5,
         STARTING_GAME_HOURS_MAX: 10,
         DEFAULT_METACRITIC: 70,
         DEFAULT_HOURS_TO_BEAT: 30,
       };
       ```

5. âœ… Update Storage Structure
   - File: lib/storage.ts
     âœ… Update StoredState interface to match new VaultState
     âœ… Update saveToStorage() to handle dual currency
     âœ… Update loadFromStorage() to handle new structure
     âœ… Add version migration logic (v1.0 saves should be cleared)

6. âœ… Create Utility Functions
   - File: lib/game-utils.ts (NEW)
     âœ… Function: enrichGameWithMetadata(game: SteamGame): Promise<SteamGame>
       - Fetch Metacritic from Steam Store API
       - Fetch hours-to-beat from SteamSpy
       - Calculate unlock cost
       - Determine tier
       - Return enriched game
     
     âœ… Function: selectStartingGame(games: SteamGame[]): SteamGame | null
       - Filter: Metacritic 70-79, 5-10 hours played
       - Fallback: Any game with 5-10 hours played
       - Fallback: Lowest playtime game
       - Return selected game or null

7. âœ… Audit Existing Code
   - Keep (reusable):
     âœ… Steam API integration (app/api/steam-library/route.ts)
     âœ… Image handling (lib/steam-images.ts)
     âœ… Virtual scrolling implementation
     âœ… localStorage patterns
     âœ… Loading/error states
     âœ… Dev panel
   
   - Modify:
     ðŸ”§ app/page.tsx (complete UI restructure for 3 sections)
     ðŸ”§ lib/vault-logic.ts (new pool-based logic)
     ðŸ”§ types/* (new interfaces)
   
   - Remove:
     âŒ Featured game clicking system
     âŒ Single click card
     âŒ Vault Controller references
     âŒ Victory detection (moves to Milestone 8)
     âŒ Old passive income system

8. Test Foundation
   - Verify API routes work:
     * Test SteamSpy route with a game
     * Test Steam Store route with a game
     * Verify Metacritic scores retrieved
     * Verify hours-to-beat calculated
   
   - Verify formulas:
     * Calculate unlock costs for sample games
     * Verify tier classification
     * Test refresh cost calculation
   
   - Verify storage:
     * Save new structure to localStorage
     * Load and verify data integrity
     * Confirm version migration clears old saves

Success Criteria:

âœ… Vault Controller removed from codebase
âœ… SteamSpy & Steam Store API routes functional
âœ… Type definitions updated for v1.5
âœ… New formulas implemented and tested
âœ… Storage structure updated
âœ… Starting game selection logic created
âœ… No TypeScript errors
âœ… Foundation ready for Milestone 1

---

MILESTONE 1: Three-Pool Foundation âœ… COMPLETE
Goal: Establish the core three-pool system and data structures.
Tasks:

âœ… Create Pool Manager
   - File: lib/pool-manager.ts
   âœ… Implement initializePools(), promoteKeyGame(), unlockGame() functions
   âœ… Logic for selecting starting game (70s Metacritic, 5-10 hours)
   âœ… Helper functions: getGamesInPool(), needsPoolInitialization(), getPoolStats()

âœ… Update Save Data Structure
   - File: lib/storage.ts
   âœ… VaultState interface with three pool arrays
   âœ… shopSlots array added
   âœ… gameProgress map added
   âœ… saveToStorage() and loadFromStorage() updated

âœ… Initialize Pools on Load
   - File: app/page.tsx
   âœ… On Steam library fetch, call initializePools()
   âœ… Store pools in VaultState
   âœ… Save to localStorage

âœ… Test Pool Initialization
   âœ… Verified starting game selected correctly (Sid Meier's Pirates!)
   âœ… Verified Pool 1 has 1 game
   âœ… Verified Pool 2 has 239 remaining played games  
   âœ… Verified Pool 3 has 314 never-played games
   âœ… Console logs confirm proper pool distribution

Success Criteria:

âœ… Three pools correctly populated
âœ… Starting game meets criteria
âœ… Pools saved to localStorage


MILESTONE 2: Shop System with 5 Slots âœ… COMPLETE
Goal: Replace single-click card with 5-slot shop displaying locked games.
Tasks:

âœ… Create Shop Manager
   - File: lib/shop-manager.ts
   âœ… ShopManager with initializeShop(), categorizeByTier(), drawNewGame()
   âœ… Weighted tier distribution implemented

âœ… Calculate Unlock Costs
   - File: lib/constants.ts
   âœ… FORMULAS.unlockCost(metacritic, hoursTobeat)
   âœ… FORMULAS.getTier() for tier classification

âœ… Update UI Layout
   - File: app/page.tsx
   âœ… Removed single click card
   âœ… Added "Unlock with Collection Power" section
   âœ… 5 shop slots displayed horizontally
   âœ… Each slot shows: Game art, name, Metacritic, unlock cost
   âœ… "Unlock" button (disabled if not enough power)

âœ… Implement Unlock Logic
   - File: app/page.tsx
   âœ… handleShopUnlock() function
   âœ… Checks collectionPower >= unlockCost
   âœ… Deducts power
   âœ… Moves game Pool 2 â†’ Pool 1
   âœ… Empties shop slot
   âœ… Saves to localStorage

âœ… Display Empty Slots
   âœ… Empty slot shows: "ðŸ”’ Spend 10 Keys to Draw"
   âœ… Disabled if liberationKeys < 10
   âœ… Click opens Draw UI (for Milestone 4)

Success Criteria:
âœ… 5 shop slots display locked games
âœ… Unlock costs calculated correctly
âœ… Unlock button works
âœ… Games move from shop to Game Library
âœ… Empty slots displayed correctly


MILESTONE 3: Game Library with Click & Drain
Goal: Display unlocked games, implement click mechanics, and drain system.
Tasks:

Create Game Library Section

File: src/app/page.tsx
Add "Game Library" section above shop
Display all Pool 1 games as clickable cards
Sort by click value (highest first)
Each card shows: Game art, name, click value, progress bar


Implement Click Handler

File: src/lib/click-manager.ts
Class: ClickManager
Method: handleClick(appId, game, progress)
Calculate power gained = Math.floor(playtime_forever / 60)
Check if drained: currentPower >= maxPower
Return: { powerGained, isDrained }


Update Game Progress

On click:

Add powerGained to collectionPower
Update gameProgress[appId].currentPower
If drained, set gameProgress[appId].isDrained = true
Save to localStorage
Re-render card




Display Progress Bars

Each game card shows progress: currentPower / maxPower
Visual progress bar: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘
Text: "4,250 / 15,000" below progress bar


Drained State

When isDrained = true:

Card shows dark overlay
Display: "âš ï¸ DRAINED"
Calculate refresh cost: Math.ceil(metacritic / 10) keys
Show "Refresh for X ðŸ”‘" button
Clicking is disabled




Refresh Logic

On "Refresh" click:

Check if liberationKeys >= refreshCost
Deduct keys
Reset: currentPower = 0, isDrained = false
Save to localStorage
Re-render card





Success Criteria:

âœ… Game Library displays Pool 1 games
âœ… Clicking generates power
âœ… Progress bars update correctly
âœ… Games drain at correct threshold
âœ… Drained state displays correctly
âœ… Refresh button works


MILESTONE 4: Draw New Game UI âœ… COMPLETE
Goal: Implement slot machine interface for drawing games from Pool 2.
Tasks:

âœ… Create Draw Modal Component
   - File: app/page.tsx (integrated modal)
   âœ… Modal overlay with 3 card backs
   âœ… Card backs are clickable
   âœ… User clicks one â†’ reveal animation
   âœ… Shows drawn game details
   âœ… "Accept" or "Redraw for 5 ðŸ”‘" buttons

âœ… Implement Draw Logic
   - File: lib/draw-manager.ts
   âœ… drawGameFromPool2() with weighted tier targeting
   âœ… getSlotTargetTier() for tier distribution
   âœ… canAffordDraw() and canAffordRedraw() helpers

âœ… Connect to Empty Slots
   âœ… Empty slot click triggers handleDrawSlot()
   âœ… Checks if liberationKeys >= 10
   âœ… Opens DrawModal with pre-drawn game
   âœ… Card back click reveals game (handleCardReveal)
   âœ… Deducts 10 keys on reveal
   âœ… Fills shop slot with drawn game

âœ… Redraw Logic
   âœ… "Redraw" button checks liberationKeys >= 5
   âœ… Deducts 5 keys per redraw
   âœ… Calls drawGameFromPool2() again
   âœ… Shows new game reveal
   âœ… Can redraw unlimited times

âœ… Weighted Draw Implementation
   âœ… 70% chance for target tier, fallback to others
   âœ… Tier pattern: [cheap, moderate, cheap, epic, moderate]
   âœ… Console logging for debugging
   âœ… Weighted targeting verified

Success Criteria:
âœ… Empty slot opens Draw Modal
âœ… 3 card backs display
âœ… Clicking card reveals game
âœ… Drawn game fills shop slot
âœ… Redraw works and costs 5 keys
âœ… Weighted targeting works correctly


MILESTONE 5: Key Games Section âœ… COMPLETE
Goal: Display all never-played games with key rewards, click to launch Steam.
Tasks:

âœ… Create Key Games Section
   - File: app/page.tsx (integrated section)
   âœ… "â­ Key Games" section below Game Library
   âœ… Grid layout (2-5 columns responsive)
   âœ… All Pool 3 games displayed
   âœ… Full game art with overlay
   âœ… Key value shown (ðŸ”‘ {metacritic} Keys)

âœ… Calculate Key Values
   âœ… Key value = Metacritic score
   âœ… Display as: "ðŸ”‘ 87 Keys"
   âœ… Default to 70 if no Metacritic

âœ… Click to Launch Steam
   âœ… On card click: window.open(`steam://store/${appId}`, '_blank')
   âœ… Launches Steam app to game's store page
   âœ… Console logging for debugging
   âœ… Hover overlay shows play icon (â–¶ï¸)

âœ… Visual Design
   âœ… Full-color game art (not locked/darkened)
   âœ… Golden border (border-vault-gold)
   âœ… Sort by Metacritic (highest first), then alphabetically
   âœ… Hover effects: scale + shadow
   âœ… Info overlay with game name + key value
   âœ… Instruction text: "Click any game to launch it in Steam. Play 30+ minutes to earn keys!"

Success Criteria:
âœ… All Pool 3 games displayed (~314 games)
âœ… Key values shown correctly
âœ… Clicking opens Steam app
âœ… Grid layout responsive
âœ… Sorted by value (highest keys first)


MILESTONE 6: Key Game Detection & Rewards
Goal: Detect when player has played a Key Game, award keys, move to Pool 2.
Tasks:

Create Detection System

File: src/lib/key-game-detector.ts
Class: KeyGameDetector
Method: detectNewlyPlayed(steamId, pool3, lastPlaytimes)
Compare current Steam playtime vs cached playtime
If delta >= 30 minutes, game was played


Store Last Playtimes

In gameProgress: Add lastPlaytime: number field
Update on every Steam API fetch
Use to calculate delta


Award Keys on Return

On Steam library re-fetch:

Call keyGameDetector.detectNewlyPlayed()
For each newly played game:

Award keys = Metacritic score
Move game Pool 3 â†’ Pool 2
Show celebration notification
Auto-refresh all drained games (call clickManager.autoRefreshAll())






Celebration Notification

File: src/components/CelebrationToast.tsx
Toast notification: "ðŸŽ‰ You played Hades! +93 ðŸ”‘ Keys earned!"
Auto-dismiss after 5 seconds
Multiple toasts if multiple games played


Auto-Refresh All Drained

File: src/lib/click-manager.ts
Method: autoRefreshAll(gameProgress)
Loop through all game progress
If isDrained = true, reset: currentPower = 0, isDrained = false
Free refresh (no key cost)


Periodic Sync

On component mount, check if lastSync > 5 minutes ago
If yes, re-fetch Steam library
Run detection system
Update UI



Success Criteria:

âœ… Playing Key Game detected correctly
âœ… Keys awarded = Metacritic score
âœ… Game moves Pool 3 â†’ Pool 2
âœ… Celebration notification shown
âœ… All drained games auto-refresh
âœ… Sync runs periodically


MILESTONE 7: UI Polish & Animations
Goal: Add visual polish, animations, and improved UX.
Tasks:

Card Reveal Animation

DrawModal card flip: 3D flip animation (CSS transform: rotateY())
Duration: 500ms
Easing: ease-out


Progress Bar Animation

Smooth width transition when clicking
Color shift when approaching drain (green â†’ yellow â†’ red)


Tier Visual Differentiation

Cheap games: Gray/silver border
Moderate games: Blue/purple border with subtle glow
Epic games: Gold/orange border with strong glow


Hover States

Game cards: Lift on hover (transform: translateY(-4px))
Buttons: Brightness increase
Smooth transitions (200ms)


Empty Slot Visual

Dashed border for empty slots
Lock icon centered
Subtle pulse animation on hover


Drained Game Visual

Dark overlay (50% opacity)
Desaturate game art (grayscale filter)
Red border to indicate attention needed


Loading States

Skeleton loading for game cards during fetch
Spinner for Draw UI
Disable buttons during operations


Responsive Design

Stack shop slots vertically on mobile
Reduce card sizes on small screens
Collapsible sections for mobile



Success Criteria:

âœ… Animations smooth and performant
âœ… Tiers visually distinct
âœ… Hover states engaging
âœ… Loading states clear
âœ… Mobile-friendly layout


MILESTONE 8: Testing & Bug Fixes
Goal: Comprehensive testing and bug fixes before deployment.
Test Cases:

Pool Transitions

 Starting game selected correctly
 Unlocking moves game Pool 2 â†’ Pool 1
 Playing Key Game moves Pool 3 â†’ Pool 2
 No games appear in multiple pools


Shop Mechanics

 Initial shop has correct tier distribution
 Unlock costs calculated correctly
 Unlocking empties slot
 Draw fills empty slot with correct tier
 Redraw gives different game


Click & Drain

 Clicks generate correct power
 Progress bars update correctly
 Games drain at correct threshold
 Refresh costs calculated correctly
 Manual refresh works


Key Game Detection

 Playing game for 30+ min detected
 Keys awarded = Metacritic score
 Game moves to Pool 2
 Auto-refresh triggers
 Celebration notification shows


Edge Cases

 Pool 2 empty: Draw shows "No games available"
 Pool 3 empty: Key Games shows "All games played!"
 Not enough keys: Buttons disabled
 Not enough power: Unlock disabled
 Private Steam profile: Error message


localStorage

 Save/load works correctly
 Pools persist across sessions
 Progress persists correctly
 Cache expiration works


Performance

 Large libraries (500+ games) load quickly
 Clicking is responsive (no lag)
 Draw UI smooth
 No memory leaks



Bug Fixes:

Fix any issues discovered during testing
Handle edge cases gracefully
Improve error messages
Optimize performance bottlenecks

Success Criteria:

âœ… All test cases pass
âœ… No critical bugs
âœ… Performance acceptable
âœ… Error handling robust


MILESTONE 9: Deployment & Documentation
Goal: Deploy to Vercel and finalize documentation.
Tasks:

Environment Setup

Verify STEAM_API_KEY in Vercel environment variables
Test production build locally: npm run build
Check for TypeScript errors


Deploy to Vercel

Push to GitHub main branch
Verify auto-deploy triggers
Test on live URL: steam-vault-escape.vercel.app


User Documentation

File: README.md
How to use the app
How to find Steam ID
How the three pools work
How to earn keys


Developer Documentation

Code comments for complex logic
Architecture overview
How to add new features
Testing instructions


Post-Launch Monitoring

Check Vercel logs for errors
Monitor user feedback
Track usage metrics (if available)



Success Criteria:

âœ… App deployed and accessible
âœ… No errors in production
âœ… Documentation complete
âœ… Ready for user testing


MILESTONE 10: Future Enhancements (Post-v1.5)
Goal: Plan and implement additional features based on user feedback.
Potential Features:

Passive Key Generation

Earn 1 key per hour of total library playtime
Incentivizes playing anything, not just Key Games


Daily Challenges

"Play a horror game today" â†’ Bonus keys
"Unlock 3 games" â†’ Bonus power multiplier


Collection Milestones

Unlock all RPGs â†’ Permanent +10% power bonus
Play 50 Key Games â†’ Unlock special tier


Bulk Operations

"Refresh All Drained" button (costs total refresh cost)
"Draw 5 Games" button (costs 50 keys, fills all empty slots)


Friend Leaderboards

Compare unlock progress with Steam friends
"Who played more Key Games this week?"


Prestige System

Reset all progress for permanent bonuses
Prestige levels with cosmetic rewards


Enhanced Analytics

Graphs of progress over time
Genre breakdown of library
Cost-per-hour analysis



Implementation: Based on user feedback and priorities after v1.5 launch.
