<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Stream your Dropbox music library with lock screen controls">
  <meta name="theme-color" content="#1DB954">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Music">
  
  <title>PLAYBACK</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="assets/icons/icon-tape-black.png" id="favicon">
  <link rel="apple-touch-icon" href="assets/icons/icon-tape-black.png">
  
  <style>
    /* Make favicon white using CSS filter */
    #favicon {
      filter: brightness(0) invert(1);
    }
  </style>
  
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/sidebar.css">
  <link rel="stylesheet" href="css/player.css">
  <link rel="stylesheet" href="css/home.css">
  <link rel="stylesheet" href="css/library.css">
  <link rel="stylesheet" href="css/playlists.css">
  <link rel="stylesheet" href="css/sources.css">
  <link rel="stylesheet" href="css/search.css">
  <link rel="stylesheet" href="css/modals.css">
</head>
<body>
  <div id="app" class="app-container">
    <!-- Desktop Sidebar -->
    <aside id="appSidebar" class="app-sidebar" style="display: none;">
      <div class="sidebar-header">
        <h2>PLAYBACK</h2>
        <button id="sidebarCollapseBtn" class="sidebar-collapse-btn" title="Collapse sidebar">
          <span>‚Äπ</span>
        </button>
      </div>
      
      <nav class="sidebar-nav">
        <button class="sidebar-nav-btn active" data-screen="home">
          <span class="sidebar-nav-icon">üè†</span>
          <span class="sidebar-nav-label">HOME</span>
        </button>
        <button class="sidebar-nav-btn" data-screen="library">
          <span class="sidebar-nav-icon">üéµ</span>
          <span class="sidebar-nav-label">LIBRARY</span>
        </button>
        <button class="sidebar-nav-btn" data-screen="sources">
          <span class="sidebar-nav-icon">üåê</span>
          <span class="sidebar-nav-label">SOURCES</span>
        </button>
      </nav>
      
      <div class="sidebar-playlists">
        <h3 class="sidebar-playlists-title">PLAYLISTS</h3>
        <button id="sidebarCreatePlaylistBtn" class="sidebar-create-playlist-btn">
          <span class="create-icon">+</span>
          <span>Create Playlist</span>
        </button>
        <div id="sidebarPlaylistsList" class="sidebar-playlists-list">
          <!-- Playlists will be dynamically populated -->
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="app-main">
      <!-- Authentication Screen -->
      <div id="authScreen" class="screen active">
        <div class="welcome-container">
          <div class="welcome-icon">üéµ</div>
          <h2>Welcome to My Music Player</h2>
          <p>Connect your Dropbox account to start streaming your music library.</p>
          <button id="connectDropboxBtn" class="btn-primary">Connect to Dropbox</button>
        </div>
      </div>

      <!-- Loading Screen -->
      <div id="loadingScreen" class="screen">
        <div class="loading-container">
          <div class="spinner"></div>
          <p id="loadingMessage">Loading...</p>
        </div>
      </div>

      <!-- Home Screen -->
      <div id="homeScreen" class="screen">
        <div class="home-header">
          <h1>MY MUSIC COLLECTION</h1>
          <div class="home-header-actions">
            <button id="globalSearchBtn" class="icon-btn" title="Search (Ctrl+K)">
              <span>üîç</span>
            </button>
            <button id="refreshFoldersBtn" class="icon-btn" title="Refresh folders">üîÑ</button>
          </div>
        </div>
        <div id="folderGrid" class="folder-grid">
          <!-- Folder cards will be added dynamically by home.js -->
        </div>
      </div>

      <!-- Library Screen -->
      <div id="libraryScreen" class="screen">
        <!-- Library Tabs -->
        <div class="library-tabs">
          <button class="tab-btn active" data-tab="songs">Songs</button>
          <button class="tab-btn" data-tab="artists">Artists</button>
          <button class="tab-btn" data-tab="albums">Albums</button>
        </div>

        <!-- Search Bar -->
        <div class="search-container">
          <input type="text" id="searchInput" class="search-input" placeholder="Search songs, artists, albums...">
          <button id="clearSearchBtn" class="clear-search-btn" style="display: none;">‚úï</button>
        </div>

        <!-- Library Content -->
        <div id="libraryContent" class="library-content">
          <div class="empty-state">
            <p>No tracks found</p>
            <button id="addSongsBtn" class="btn-secondary">Add Songs</button>
          </div>
        </div>
      </div>

      <!-- Playlists Screen -->
      <div id="playlistsScreen" class="screen">
        <div class="playlists-header">
          <h2>Playlists</h2>
          <button id="createPlaylistBtn" class="btn-primary">+ New Playlist</button>
        </div>
        <div id="playlistsContent" class="playlists-content">
          <div class="empty-state">
            <p>No playlists yet</p>
            <p class="empty-state-subtitle">Create a playlist to get started</p>
          </div>
        </div>
      </div>

      <!-- Playlist Detail Screen -->
      <div id="playlistDetailScreen" class="screen">
        <div class="playlist-detail-header">
          <button id="closePlaylistDetailBtn" class="icon-btn">‚Üê</button>
          <h2 id="playlistDetailTitle">Playlist</h2>
          <button id="playlistDetailMenuBtn" class="icon-btn">‚ãÆ</button>
        </div>
        
        <div class="playlist-detail-info">
          <div id="playlistDetailStats" class="playlist-stats"></div>
          <button id="playPlaylistDetailBtn" class="btn-primary" style="display: none; width: 100%; max-width: 400px;">
            ‚ñ∂ Play All
          </button>
        </div>
        
        <div id="playlistDetailContent" class="library-content">
          <!-- Tracks will be added dynamically -->
        </div>
      </div>

      <!-- Queue Screen -->
      <div id="queueScreen" class="screen">
        <div class="queue-header">
          <button id="closeQueueBtn" class="icon-btn">‚Üê</button>
          <h2>Queue</h2>
          <button id="clearQueueBtn" class="btn-text">Clear</button>
        </div>
        <div id="queueContent" class="queue-content">
          <div class="empty-state">
            <p>Queue is empty</p>
          </div>
        </div>
      </div>

      <!-- Sources Screen -->
      <div id="sourcesScreen" class="screen">
        <div class="sources-container">
          <!-- Left Sidebar: Connection Icons -->
          <div class="sources-sidebar">
            <h2 class="sources-sidebar-title">SOURCES</h2>
            
            <div id="sourcesConnectionsList" class="sources-connections">
              <!-- Dropbox Connection -->
              <button class="source-connection-btn active" data-source="dropbox" id="dropboxSourceBtn">
                <div class="source-icon">
                  <img src="assets/icons/dropbox.png" alt="Dropbox" class="source-logo">
                </div>
                <div class="source-info">
                  <div class="source-name">Dropbox</div>
                  <div class="source-status" id="dropboxStatus">
                    <span class="status-indicator connected">‚úì</span>
                    <span class="source-count" id="dropboxCount">0 folders ‚Ä¢ 0 songs</span>
                  </div>
                </div>
              </button>

              <!-- Google Drive Connection (Placeholder) -->
              <button class="source-connection-btn disabled" data-source="google-drive" disabled>
                <div class="source-icon">
                  <img src="assets/icons/googledrive.png" alt="Google Drive" class="source-logo greyed">
                </div>
                <div class="source-info">
                  <div class="source-name">Google Drive</div>
                  <div class="source-status">Coming soon</div>
                </div>
              </button>

              <!-- OneDrive Placeholder -->
              <button class="source-connection-btn disabled" data-source="onedrive" disabled>
                <div class="source-icon">
                  <img src="assets/icons/onedrive.png" alt="OneDrive" class="source-logo greyed">
                </div>
                <div class="source-info">
                  <div class="source-name">OneDrive</div>
                  <div class="source-status">Coming soon</div>
                </div>
              </button>

              <!-- Plex Placeholder -->
              <button class="source-connection-btn disabled" data-source="plex" disabled>
                <div class="source-icon">
                  <img src="assets/icons/plex.png" alt="Plex" class="source-logo greyed">
                </div>
                <div class="source-info">
                  <div class="source-name">Plex</div>
                  <div class="source-status">Coming soon</div>
                </div>
              </button>

              <!-- Network Drive Placeholder -->
              <button class="source-connection-btn disabled" data-source="network" disabled>
                <div class="source-icon">
                  <img src="assets/icons/networkdrive.png" alt="Network Drive" class="source-logo greyed">
                </div>
                <div class="source-info">
                  <div class="source-name">Network Drive</div>
                  <div class="source-status">Coming soon</div>
                </div>
              </button>

              <!-- Phone Placeholder -->
              <button class="source-connection-btn disabled" data-source="phone" disabled>
                <div class="source-icon">
                  <img src="assets/icons/phone.png" alt="Phone" class="source-logo greyed">
                </div>
                <div class="source-info">
                  <div class="source-name">Phone</div>
                  <div class="source-status">Coming soon</div>
                </div>
              </button>
            </div>
          </div>

          <!-- Main Content: Folder Browser & File Preview -->
          <div class="sources-main">
            <!-- Dropbox Browser -->
            <div id="dropboxBrowser" class="source-browser active">
              <!-- Folder Browser Panel -->
              <div class="browser-panel">
                <div class="browser-header">
                  <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                      <h3>DROPBOX</h3>
                      <div class="browser-breadcrumb" id="dropboxBreadcrumb">
                        <span class="breadcrumb-item">All Files</span>
                      </div>
                    </div>
                    <button id="addCurrentFolderBtn" class="folder-add-btn" style="display: none;" title="Add current folder">+</button>
                  </div>
                </div>

                <div class="browser-content" id="dropboxFolderList">
                  <div class="loading">Loading folders...</div>
                </div>
              </div>

              <!-- File Preview Panel -->
              <div class="preview-panel">
                <div class="preview-header">
                  <h3 id="previewTitle">Preview</h3>
                </div>
                <div class="preview-content" id="previewContent">
                  <div class="empty-state">
                    <p>Click on a folder to preview its contents</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Google Drive Browser (Placeholder) -->
            <div id="googleDriveBrowser" class="source-browser">
              <div class="connect-prompt">
                <div class="connect-icon">üìÅ</div>
                <h3>Connect to Google Drive</h3>
                <p>Link your Google Drive account to access your music files</p>
                <button class="btn-primary" disabled>Coming Soon</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Now Playing Bar (Mini Player) -->
    <div id="miniPlayer" class="mini-player" style="display: none;">
      <div class="mini-player-content" id="miniPlayerContent">
        <img id="miniPlayerArt" class="mini-player-art" src="assets/icons/icon-song-black..png" alt="Album Art">
        <div class="mini-player-info">
          <div class="mini-player-title">No track playing</div>
          <div class="mini-player-artist">‚Äî</div>
        </div>
        <button id="miniPlayPauseBtn" class="mini-play-btn">‚ñ∂</button>
      </div>
    </div>

    <!-- Full Player Screen -->
    <div id="playerScreen" class="player-screen">
      <div class="player-header">
        <button id="closePlayerBtn" class="icon-btn">‚ñº</button>
        <span class="player-header-title">Now Playing</span>
        <button id="queueBtn" class="icon-btn">‚ò∞</button>
      </div>

      <div class="player-content">
        <!-- Album Art -->
        <div class="album-art-container">
          <img id="albumArt" class="album-art" src="assets/icons/icon-song-black..png" alt="Album Art">
        </div>

        <!-- Track Info -->
        <div class="track-info">
          <h2 id="trackTitle" class="track-title">No track playing</h2>
          <p id="trackArtist" class="track-artist">‚Äî</p>
        </div>

        <!-- Timeline -->
        <div class="timeline-container">
          <div class="timeline-times">
            <span id="currentTime" class="time-current">0:00</span>
            <span id="totalTime" class="time-total">0:00</span>
          </div>
          <div class="timeline" id="timeline">
            <div class="timeline-progress" id="timelineProgress"></div>
            <div class="timeline-handle" id="timelineHandle"></div>
          </div>
        </div>

        <!-- Playback Controls -->
        <div class="playback-controls">
          <button id="shuffleBtn" class="control-btn control-btn-small" title="Shuffle">
            <span>üîÄ</span>
          </button>
          <button id="skipBackBtn" class="control-btn" title="Previous">
            <span>‚èÆ</span>
          </button>
          <button id="playPauseBtn" class="control-btn control-btn-large" title="Play">
            <span id="playPauseIcon">‚ñ∂</span>
          </button>
          <button id="skipForwardBtn" class="control-btn" title="Next">
            <span>‚è≠</span>
          </button>
          <button id="repeatBtn" class="control-btn control-btn-small" title="Repeat">
            <span>üîÅ</span>
          </button>
        </div>

        <!-- Volume Control -->
        <div class="volume-container">
          <span class="volume-icon">üîä</span>
          <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="80">
        </div>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <button class="nav-btn" data-screen="home">
        <span class="nav-icon">üè†</span>
        <span class="nav-label">Home</span>
      </button>
      <button class="nav-btn" data-screen="library">
        <span class="nav-icon">üéµ</span>
        <span class="nav-label">Library</span>
      </button>
      <button class="nav-btn" data-screen="playlists">
        <span class="nav-icon">üìã</span>
        <span class="nav-label">Playlists</span>
      </button>
      <button class="nav-btn" data-screen="sources">
        <span class="nav-icon">üåê</span>
        <span class="nav-label">Sources</span>
      </button>
    </nav>
  </div>

  <!-- Context Menu (for Add to Playlist, etc.) -->
  <div id="contextMenu" class="context-menu" style="display: none;"></div>

  <!-- Toast Notifications -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Global Search Modal -->
  <div id="searchOverlay" class="search-overlay">
    <div id="searchModal" class="search-modal">
      <div class="search-header">
        <span class="search-icon">üîç</span>
        <div class="search-input-container">
          <input type="text" id="globalSearchInput" class="search-input" placeholder="Search everything..." autocomplete="off">
        </div>
        <button id="closeSearchBtn" class="close-search-btn">‚úï</button>
      </div>
      <div id="searchResults" class="search-results-container">
        <!-- Results will be dynamically populated -->
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
